# [PYAI-2-4-06] 文件扫描

> **模块**：L2-M4 计算机视觉
> **认知负荷**：高
> **核心技能**：二值化cv2.threshold、去阴影cv2.divide
> **UID**：PYAI-24-06-001

---

## 课程基本信息

| 项目 | 内容 |
|------|------|
| **课程编号** | PYAI-2-4-06 |
| **课程名称** | 文件扫描 - 文档扫描仪 |
| **认知负荷** | 高 |
| **核心技能** | 二值化cv2.threshold、去阴影cv2.divide |
| **项目内容** | 文档扫描仪 |

---

## 详细教学流程

### 步骤1：知识讲解（20分钟）

`#中负荷-操练` `#IFC-即时`

**教师话术**
> "今天我们来做一个**文档扫描仪**！把手机拍的文档照片变成清晰的扫描件。
>
> 主要解决两个问题：
> 1. **去除阴影**：拍照时光线不均匀会有阴影
> 2. **二值化**：把灰色变成纯黑白，更清晰
>
> ```python
> import cv2
>
> # 读取图片并转灰度
> img = cv2.imread('document.jpg')
> gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
>
> # 二值化：像素值大于阈值变白，否则变黑
> ret, binary = cv2.threshold(gray, 127, 255, cv2.THRESH_BINARY)
> ```
>
> **阈值127**的意思是：灰度值>127的变成255(白)，≤127的变成0(黑)。"

**变体示例**

| 学生情况 | 调整方案 | 说明 |
|----------|----------|------|
| 阈值效果不好 | 用自适应阈值 | `cv2.adaptiveThreshold`自动计算局部阈值 |
| 有阴影干扰 | 先去阴影 | 用`cv2.divide`消除光照不均 |
| 想反转黑白 | 改变类型 | 用`cv2.THRESH_BINARY_INV`反转 |

---

### 步骤2：代码实践（35分钟）

`#高负荷-产出` `#IFC-即时`

**教师话术**
> "普通二值化对阴影效果不好，我们用**自适应阈值**和**去阴影**技术：
>
> ```python
> # 方法1：自适应阈值（自动计算局部阈值）
> adaptive = cv2.adaptiveThreshold(
>     gray, 255,
>     cv2.ADAPTIVE_THRESH_GAUSSIAN_C,  # 高斯加权
>     cv2.THRESH_BINARY,
>     11,  # 邻域大小
>     2    # 常数C
> )
>
> # 方法2：去阴影（更专业的方法）
> # 1. 用高斯模糊获取背景
> blur = cv2.GaussianBlur(gray, (21, 21), 0)
> # 2. 用原图除以背景，消除光照不均
> divided = cv2.divide(gray, blur, scale=255)
> # 3. 再二值化
> ret, result = cv2.threshold(divided, 200, 255, cv2.THRESH_BINARY)
> ```
>
> **cv2.divide的原理**：背景亮的地方除以大数，背景暗的地方除以小数，结果就均匀了！"

---

## 核心代码模式

```python
# 文档扫描标准流程
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
blur = cv2.GaussianBlur(gray, (21, 21), 0)
divided = cv2.divide(gray, blur, scale=255)
ret, binary = cv2.threshold(divided, 200, 255, cv2.THRESH_BINARY)
```

---

## 禁忌提醒

- 阈值设置不当——太高全白，太低全黑
- 自适应阈值邻域用偶数——必须是奇数
- 忘记转灰度——threshold只能处理单通道图像

---

## 核心知识点

- 二值化(threshold)：将灰度图转为纯黑白
- 自适应阈值：根据局部区域自动计算阈值
- cv2.divide：消除光照不��匀（去阴影）
- 文档扫描流程：灰度→去阴影→二值化

**底层逻辑**
- **光照归一化**：divide操作消除光照差异
- **局部自适应**：不同区域用不同阈值

`#执行层` `#测评项`
[UID: PYAI-24-06-001]
[关联: PYAI-24-05-001 滤波降噪（前置课程）]
[关联: PYAI-24-08-001 人像分割（后续课程）]

---

[上一课](PYAI-2-4-05_滤波降噪.md) | [模块概览](_模块概览.md) | [下一课](PYAI-2-4-08_人像分割.md)
