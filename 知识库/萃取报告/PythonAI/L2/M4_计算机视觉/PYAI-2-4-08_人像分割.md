# [PYAI-2-4-08] 人像分割

> **模块**：L2-M4 计算机视觉
> **认知负荷**：高
> **核心技能**：MediaPipe Selfie Segmentation、Mask掩膜
> **UID**：PYAI-24-08-001

---

## 课程基本信息

| 项目 | 内容 |
|------|------|
| **课程编号** | PYAI-2-4-08/09 |
| **课程名称** | 人像分割 - 视频会议虚拟背景 |
| **认知负荷** | 高 |
| **核心技能** | MediaPipe Selfie Segmentation、Mask掩膜 |
| **项目内容** | 视频会议虚拟背景 |
| **课时** | 2节课（08-09） |

---

## 详细教学流程

### 步骤1：知识讲解（20分钟）

`#中负荷-操练` `#IFC-即时`

**教师话术**
> "大家用过视频会议的虚拟背景吗？今天我们来做一个！
>
> 原理是**人像分割**：AI模型识别出哪些像素是人，哪些是背景。然后用新背景替换掉原背景。
>
> ```python
> import mediapipe as mp
>
> # 初始化人像分割模型
> selfie_segmentation = mp.solutions.selfie_segmentation
> segment = selfie_segmentation.SelfieSegmentation()
>
> # 获取掩膜
> results = segment.process(frame)
> mask = results.segmentation_mask  # 人像区域是1，背景是0
> ```"

**变体示例**

| 学生情况 | 调整方案 | 说明 |
|----------|----------|------|
| 边缘不干净 | 调整阈值 | `mask > 0.5` 改成 `mask > 0.7` |
| 想用自己的背景 | 加载自定义图片 | 用cv2.imread加载背景图 |
| 帧率太低 | 降低分辨率 | 先resize再处理 |

---

### 步骤2：代码实践（35分钟）

`#高负荷-产出` `#IFC-即时`

**教师话术**
> "现在我们用`numpy.where`来替换背景：
>
> ```python
> import numpy as np
>
> # 三通道掩膜
> mask_3d = np.stack([mask, mask, mask], axis=-1)
>
> # 替换背景
> output = np.where(mask_3d > 0.5, frame, background)
> ```
>
> `np.where`的意思是：如果条件成立，用第一个值；否则用第二个值。"

---

## 禁忌提醒

- 图像尺寸不匹配——frame和background必须尺寸相同
- 通道数不一致——都必须是3通道

---

## 核心知识点

- Selfie Segmentation：人像分割模型
- Mask掩膜：0/1遮罩原理
- 背景融合：`numpy.where` 替换背景

`#执行层` `#测评项`
[UID: PYAI-24-08-001]
[关联: PYAI-24-06-001 文件扫描（前置课程）]
[关联: PYAI-24-10-001 虚拟墨镜（后续课程）]

---

[上一课](PYAI-2-4-06_文件扫描.md) | [模块概览](_模块概览.md) | [下一课](PYAI-2-4-10_虚拟墨镜.md)
