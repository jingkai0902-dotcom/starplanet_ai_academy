# [PYAI-2-4-04] 图像编辑2

> **模块**：L2-M4 计算机视觉
> **认知负荷**：高
> **核心技能**：ROI区域替换、cv2.resize、os.listdir
> **UID**：PYAI-24-04-001

---

## 课程基本信息

| 项目 | 内容 |
|------|------|
| **课程编号** | PYAI-2-4-04 |
| **课程名称** | 图像编辑2 - 局部马赛克 |
| **认知负荷** | 高 |
| **核心技能** | ROI区域替换、cv2.resize、os.listdir |
| **项目内容** | 局部马赛克 |

---

## 详细教学流程

### 步骤1：知识讲解（20分钟）

`#中负荷-操练` `#IFC-即时`

**教师话术**
> "上节课我们学了整张图片的操作，今天学习**局部区域操作**！
>
> **ROI (Region of Interest)** 就是'感兴趣区域'，我们可以只处理图片的一部分。
>
> ```python
> import cv2
>
> img = cv2.imread('photo.jpg')
>
> # 用切片获取ROI区域 [y1:y2, x1:x2]
> roi = img[100:200, 150:250]  # 从(150,100)到(250,200)的区域
>
> # 修改ROI
> roi[:] = [0, 0, 255]  # 把这个区域变成红色
>
> # 或者替换为另一张图片
> small_img = cv2.imread('logo.png')
> small_img = cv2.resize(small_img, (100, 100))  # 调整大小
> img[100:200, 150:250] = small_img  # 替换
> ```"

**变体示例**

| 学生情况 | 调整方案 | 说明 |
|----------|----------|------|
| 切片顺序混淆 | 强调y在前 | `img[y1:y2, x1:x2]`，先行后列 |
| 尺寸不匹配 | 用resize调整 | 替换区域和图片尺寸必须一致 |
| 想批量处理 | 介绍os.listdir | 遍历文件夹中的所有图片 |

---

### 步骤2：代码实践（35分钟）

`#高负荷-产出` `#IFC-即时`

**教师话术**
> "现在我们来做**马赛克效果**！原理是：把一个区域缩小再放大，细节就丢失了。
>
> ```python
> def add_mosaic(img, x1, y1, x2, y2, factor=10):
>     '''给指定区域添加马赛克'''
>     roi = img[y1:y2, x1:x2]
>     h, w = roi.shape[:2]
>
>     # 先缩小
>     small = cv2.resize(roi, (w//factor, h//factor))
>     # 再放大回原尺寸（用最近邻插值保持块状效果）
>     mosaic = cv2.resize(small, (w, h), interpolation=cv2.INTER_NEAREST)
>
>     # 替换原区域
>     img[y1:y2, x1:x2] = mosaic
>     return img
>
> # 使用示例
> img = add_mosaic(img, 100, 50, 200, 150)
> ```"

---

### 步骤3：批量处理（15分钟）

`#高负荷-产出` `#IFC-即时`

**教师话术**
> "如果要处理很多图片怎么办？用`os.listdir`遍历文件夹：
>
> ```python
> import os
>
> folder = 'photos/'
> for filename in os.listdir(folder):
>     if filename.endswith('.jpg'):
>         img = cv2.imread(folder + filename)
>         # 处理图片...
>         cv2.imwrite('output/' + filename, img)
> ```"

---

## 核心代码模式

```python
# ROI操作标准模板
roi = img[y1:y2, x1:x2]  # 获取区域
roi = cv2.resize(roi, (new_w, new_h))  # 调整大小
img[y1:y2, x1:x2] = processed_roi  # 替换回去
```

---

## 禁忌提醒

- ROI切片顺序错误——`img[y:y, x:x]`不是`img[x:x, y:y]`
- 替换区域尺寸不匹配——会报错
- 忘记检查文件扩展名——可能读取非图片文件

---

## 核心知识点

- ROI区域：用切片`img[y1:y2, x1:x2]`获取
- cv2.resize：调整图片尺寸
- 马赛克原理：缩小再放大丢失细节
- os.listdir：遍历文件夹批量处理

**底层逻辑**
- **局部处理**：只修改需要的区域，提高效率
- **批量自动化**：用循环处理大量文件

`#执行层` `#测评项`
[UID: PYAI-24-04-001]
[关联: PYAI-24-03-001 图像编辑1（前置课程）]
[关联: PYAI-24-05-001 滤波降噪（后续课程）]

---

[上一课](PYAI-2-4-03_图像编辑1.md) | [模块概览](_模块概览.md) | [下一课](PYAI-2-4-05_滤波降噪.md)
