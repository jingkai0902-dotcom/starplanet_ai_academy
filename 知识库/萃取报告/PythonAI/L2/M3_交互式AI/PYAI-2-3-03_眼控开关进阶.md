# [PYAI-2-3-03] 眼控开关进阶

> **模块**：L2-M3 交互式AI
> **认知负荷**：高
> **核心技能**：状态机设计、防抖动处理、GPIO控制
> **UID**：PYAI-23-03-001

---

## 课程基本信息

| 项目 | 内容 |
|------|------|
| **课程编号** | PYAI 2-3-3 |
| **课程名称** | 眼控开关3（进阶） |
| **认知负荷** | 高 |
| **核心技能** | 状态机设计、防抖动处理、GPIO控制 |
| **项目内容** | 眨眼控制进阶 |

---

## 详细教学流程

### 步骤1：知识讲解（20分钟）

`#中负荷-操练` `#IFC-即时`

**教师话术**
> "前两节课我们实现了眨眼检测，但有个问题——眨眼太快会误触发！今天学习**状态机**和**防抖动**。"
>
> "**状态机设计**：用变量记录当前状态
> ```python
> # 状态定义
> STATE_OPEN = 0   # 眼睛睁开
> STATE_CLOSED = 1 # 眼睛闭合
> current_state = STATE_OPEN
> blink_count = 0
>
> # 状态转换逻辑
> if eye_distance < threshold:
>     if current_state == STATE_OPEN:
>         current_state = STATE_CLOSED
>         blink_count += 1
> else:
>     current_state = STATE_OPEN
> ```
>
> **防抖动处理**：连续N帧才确认状态变化
> ```python
> close_frames = 0
> DEBOUNCE_FRAMES = 3  # 连续3帧才确认
>
> if eye_distance < threshold:
>     close_frames += 1
>     if close_frames >= DEBOUNCE_FRAMES:
>         # 确认闭眼
>         trigger_action()
> else:
>     close_frames = 0
> ```"

### 步骤2：代码实践（35分钟）

`#高负荷-产出` `#IFC-即时`

**教师话术**
> "现在我们把眨眼检测和硬件控制结合起来！
> 眨眼一次开灯，再眨眼一次关灯。"

---

## 变体示例

| 学生情况 | 调整方案 | 说明 |
|----------|----------|------|
| 状态切换太快 | 增加防抖帧数 | 把DEBOUNCE_FRAMES改为5 |
| 想用双眨眼触发 | 添加计数器 | 1秒内眨眼2次才触发 |
| 没有硬件 | 用屏幕模拟 | 用pygame画一个灯泡 |

---

## 核心代码模式

```python
# 完整的眨眼控制状态机
class BlinkController:
    def __init__(self, threshold=0.01, debounce=3):
        self.threshold = threshold
        self.debounce = debounce
        self.close_frames = 0
        self.light_on = False

    def update(self, eye_distance):
        if eye_distance < self.threshold:
            self.close_frames += 1
            if self.close_frames == self.debounce:
                self.light_on = not self.light_on
                return self.light_on
        else:
            self.close_frames = 0
        return None  # 无状态变化
```

---

## 核心知识点

- **状态机**：用变量记录和管理程序状态
- **防抖动**：连续N帧确认，避免误触发
- **边沿检测**：只在状态变化时触发动作

---

## 导航

| 上一课 | 返回模块 | 下一课 |
|--------|----------|--------|
| [PYAI-2-3-01 眼控开关](PYAI-2-3-01_眼控开关.md) | [M3 交互式AI](_模块概览.md) | [PYAI-2-3-04 眼控开关综合](PYAI-2-3-04_眼控开关综合.md) |
