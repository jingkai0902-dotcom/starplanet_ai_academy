# [PYAI-2-3-05] 表情控制

> **模块**：L2-M3 交互式AI
> **认知负荷**：高
> **核心技能**：关键点特征提取、pygame音频播放
> **UID**：PYAI-23-05-001

---

## 课程基本信息

| 项目 | 内容 |
|------|------|
| **课程编号** | PYAI 2-3-5 |
| **课程名称** | 表情控制 |
| **认知负荷** | 高 |
| **核心技能** | 关键点特征提取、pygame音频播放 |
| **项目内容** | 表情音乐播放器 |

---

## 详细教学流程

### 步骤1：知识讲解（20分钟）

`#中负荷-操练` `#IFC-即时`

**教师话术**
> "今天我们用FaceMesh识别表情！不同表情会播放不同音乐。"
>
> "**表情识别原理**：通过关键点的相对位置判断表情
>
> **嘴巴张开检测**：
> ```python
> # 上嘴唇和下嘴唇的关键点
> upper_lip = landmarks[13]  # 上嘴唇中点
> lower_lip = landmarks[14]  # 下嘴唇中点
>
> mouth_open = abs(upper_lip.y - lower_lip.y)
> if mouth_open > 0.05:
>     print('嘴巴张开了！')
> ```
>
> **微笑检测**：
> ```python
> # 嘴角的关键点
> left_corner = landmarks[61]   # 左嘴角
> right_corner = landmarks[291] # 右嘴角
> mouth_center = landmarks[13]  # 嘴唇中点
>
> # 嘴角上扬 = 微笑
> if left_corner.y < mouth_center.y and right_corner.y < mouth_center.y:
>     print('检测到微笑！')
> ```"

### 步骤2：pygame音频播放（15分钟）

`#中负荷-操练` `#IFC-即时`

**教师话术**
> "学习用pygame播放音乐：
> ```python
> import pygame
>
> pygame.mixer.init()
>
> # 加载音乐
> happy_music = pygame.mixer.Sound('happy.wav')
> sad_music = pygame.mixer.Sound('sad.wav')
>
> # 播放音乐
> if is_smiling:
>     happy_music.play()
> elif is_mouth_open:
>     sad_music.play()
> ```"

### 步骤3：代码实践（35分钟）

`#高负荷-产出` `#IFC-即时`

**教师话术**
> "创建一个表情音乐播放器：
> - 微笑 → 播放欢快音乐
> - 张嘴 → 播放惊讶音效
> - 皱眉 → 播放悲伤音乐"

---

## 变体示例

| 学生情况 | 调整方案 | 说明 |
|----------|----------|------|
| 关键点索引记不住 | 提供索引表 | 打印常用关键点索引对照表 |
| 音乐文件找不到 | 检查路径 | 使用绝对路径或放在同一目录 |
| 表情识别不准 | 调整阈值 | 打印数值，根据实际情况调整 |
| 想识别更多表情 | 组合特征 | 眉毛+嘴巴组合判断复杂表情 |

---

## 核心代码模式

```python
# 表情音乐播放器完整代码框架
import cv2
import mediapipe as mp
import pygame

pygame.mixer.init()

class ExpressionMusicPlayer:
    def __init__(self):
        self.face_mesh = mp.solutions.face_mesh.FaceMesh()
        self.sounds = {
            'smile': pygame.mixer.Sound('happy.wav'),
            'surprise': pygame.mixer.Sound('surprise.wav')
        }
        self.last_expression = None

    def detect_expression(self, landmarks):
        # 嘴巴张开检测
        mouth_open = abs(landmarks[13].y - landmarks[14].y)
        if mouth_open > 0.05:
            return 'surprise'

        # 微笑检测
        left = landmarks[61].y
        right = landmarks[291].y
        center = landmarks[13].y
        if left < center and right < center:
            return 'smile'

        return 'neutral'

    def play_music(self, expression):
        if expression != self.last_expression and expression in self.sounds:
            self.sounds[expression].play()
            self.last_expression = expression
```

---

## 核心知识点

- **表情识别**：通过关键点相对位置判断表情
- **常用关键点**：13(上唇)、14(下唇)、61(左嘴角)、291(右嘴角)
- **pygame音频**：mixer.init()初始化，Sound()加载，play()播放

---

## 导航

| 上一课 | 返回模块 | 下一课 |
|--------|----------|--------|
| [PYAI-2-3-04 眼控开关综合](PYAI-2-3-04_眼控开关综合.md) | [M3 交互式AI](_模块概览.md) | [PYAI-2-3-06 表情控制进阶](PYAI-2-3-06_表情控制进阶.md) |
