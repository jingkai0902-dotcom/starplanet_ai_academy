# [PYAI-2-2-03] 弹幕生成器

> **模块**：L2-M2 项目应用
> **认知负荷**：高
> **核心技能**：Pygame综合、Random/Time模块、类实例应用
> **UID**：PYAI-22-03-001

---

## 课程基本信息

| 项目 | 内容 |
|------|------|
| **课程编号** | 2-2-3 |
| **课程名称** | 弹幕生成器 |
| **认知负荷** | 高 |
| **核心技能** | Pygame综合、Random/Time模块、类实例应用 |

---

## 详细教学流程

**步骤1：知识讲解（20分钟）** `#中负荷-操练` `#IFC-即时`

**教师话术**
> "今天我们做一个**弹幕生成器**！就像B站视频上飘过的弹幕一样。这个项目会用到上节课学的类和Pygame。"
>
> "**弹幕的本质**：
> - 每条弹幕是一个**对象**（有位置、速度、内容）
> - 弹幕从右边出现，向左移动
> - 用**列表**管理多条弹幕"

---

## 核心代码模式

```python
import pygame
import random

# 弹幕类
class Danmaku:
    def __init__(self, text, y):
        self.text = text
        self.x = 800  # 从右边开始
        self.y = y
        self.speed = random.randint(3, 8)
        self.color = (random.randint(0,255), random.randint(0,255), random.randint(0,255))

    def move(self):
        self.x -= self.speed  # 向左移动

    def draw(self, screen, font):
        text_surface = font.render(self.text, True, self.color)
        screen.blit(text_surface, (self.x, self.y))

# 主程序
pygame.init()
screen = pygame.display.set_mode((800, 600))
font = pygame.font.Font(None, 36)

danmaku_list = []
messages = ['Hello!', 'Pygame真好玩', '666', '前方高能']

running = True
frame_count = 0
while running:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False

    # 每60帧生成一条弹幕
    frame_count += 1
    if frame_count % 60 == 0:
        text = random.choice(messages)
        y = random.randint(50, 550)
        danmaku_list.append(Danmaku(text, y))

    screen.fill((0, 0, 0))

    # 更新和绘制所有弹幕
    for d in danmaku_list:
        d.move()
        d.draw(screen, font)

    # 移除已经飘出屏幕的弹幕
    danmaku_list = [d for d in danmaku_list if d.x > -200]

    pygame.display.flip()
    pygame.time.delay(16)  # 约60FPS

pygame.quit()
```

---

## 变体示例

| 学生情况 | 调整方案 | 说明 |
|----------|----------|------|
| 弹幕太快/太慢 | 调整speed范围 | 修改random.randint的参数 |
| 想添加自定义弹幕 | 加入input | 用pygame.KEYDOWN捕获输入 |
| 弹幕重叠 | 优化y坐标 | 检测已有弹幕位置避免重叠 |

---

## 核心知识点

- 类的综合应用：封装弹幕的属性和行为
- 列表管理对象：存储多个弹幕实例
- 列表推导式：过滤已消失的弹幕
- 帧率控制：`pygame.time.delay()`

---

`#执行层` `#测评项`
[UID: PYAI-22-03-001]

---

[上一课](PYAI-2-2-02_电子成绩单.md) | [下一课](PYAI-2-2-04_规矩方圆.md) | [返回模块概览](_模块概览.md)
