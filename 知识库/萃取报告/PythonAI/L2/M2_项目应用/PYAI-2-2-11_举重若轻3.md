# [PYAI-2-2-11] 举重若轻3

> **模块**：L2-M2 项目应用
> **认知负荷**：高
> **核心技能**：向量拆分合并、爆炸效果、音频加载
> **UID**：PYAI-22-11-001

---

## 课程基本信息

| 项目 | 内容 |
|------|------|
| **课程编号** | 2-2-11 |
| **课程名称** | 举重若轻3 |
| **认知负荷** | 高 |
| **核心技能** | 向量拆分合并、爆炸效果、音频加载 |

---

## 详细教学流程

**步骤1：知识讲解（20分钟）** `#中负荷-操练` `#IFC-即时`

**教师话术**
> "今天是大炮射击的最后一课！我们要加入**目标**、**爆炸效果**和**音效**，让游戏更完整！"
>
> "**Pygame音频**：
> ```python
> import pygame
>
> pygame.mixer.init()  # 初始化音频
>
> # 加载音效
> explosion_sound = pygame.mixer.Sound('explosion.wav')
>
> # 播放音效
> explosion_sound.play()
>
> # 加载背景音乐
> pygame.mixer.music.load('bgm.mp3')
> pygame.mixer.music.play(-1)  # -1表示循环播放
> ```
>
> **爆炸效果**：
> - 碰撞时创建爆炸粒子
> - 粒子向四周扩散
> - 逐渐消失"

---

## 核心代码模式

```python
import pygame
import math
import random

pygame.init()
pygame.mixer.init()
screen = pygame.display.set_mode((800, 600))

GRAVITY = 0.3

# 目标类
class Target:
    def __init__(self, x, y):
        self.x = x
        self.y = y
        self.radius = 25
        self.alive = True

    def draw(self, screen):
        if self.alive:
            pygame.draw.circle(screen, (255, 0, 0), (self.x, self.y), self.radius)
            pygame.draw.circle(screen, (255, 255, 255), (self.x, self.y), 15)
            pygame.draw.circle(screen, (255, 0, 0), (self.x, self.y), 5)

# 爆炸粒子类
class Particle:
    def __init__(self, x, y):
        self.x = x
        self.y = y
        angle = random.uniform(0, 2 * math.pi)
        speed = random.uniform(2, 8)
        self.vx = speed * math.cos(angle)
        self.vy = speed * math.sin(angle)
        self.life = 30  # 生命周期
        self.color = random.choice([(255,100,0), (255,200,0), (255,50,0)])

    def update(self):
        self.x += self.vx
        self.y += self.vy
        self.vy += 0.1  # 轻微重力
        self.life -= 1

    def draw(self, screen):
        if self.life > 0:
            size = max(1, self.life // 5)
            pygame.draw.circle(screen, self.color, (int(self.x), int(self.y)), size)

# 炮弹类（简化版）
class Bullet:
    def __init__(self, x, y, speed, angle):
        self.x, self.y = x, y
        rad = math.radians(angle)
        self.vx = speed * math.cos(rad)
        self.vy = -speed * math.sin(rad)
        self.active = True

    def update(self):
        self.x += self.vx
        self.vy += GRAVITY
        self.y += self.vy
        if self.y > 550: self.active = False

    def draw(self, screen):
        pygame.draw.circle(screen, (50,50,50), (int(self.x), int(self.y)), 8)

# 碰撞检测
def check_hit(bullet, target):
    dist = math.sqrt((bullet.x - target.x)**2 + (bullet.y - target.y)**2)
    return dist < target.radius + 8

# 创建爆炸
def create_explosion(x, y):
    return [Particle(x, y) for _ in range(20)]

# 游戏对象
targets = [Target(600, 500), Target(500, 450), Target(700, 480)]
bullets = []
particles = []
score = 0

running = True
while running:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False
        if event.type == pygame.KEYUP:
            if event.key == pygame.K_SPACE:
                bullets.append(Bullet(80, 480, 15, 45))

    screen.fill((135, 206, 235))
    pygame.draw.rect(screen, (34, 139, 34), (0, 550, 800, 50))

    # 更新炮弹
    for bullet in bullets[:]:
        bullet.update()
        bullet.draw(screen)

        # 检测碰撞
        for target in targets:
            if target.alive and check_hit(bullet, target):
                target.alive = False
                bullet.active = False
                particles.extend(create_explosion(target.x, target.y))
                score += 100

    bullets = [b for b in bullets if b.active]

    # 更新粒子
    for p in particles[:]:
        p.update()
        p.draw(screen)
    particles = [p for p in particles if p.life > 0]

    # 绘制目标
    for target in targets:
        target.draw(screen)

    pygame.display.flip()
    pygame.time.delay(16)

pygame.quit()
```

---

## 变体示例

| 学生情况 | 调整方案 | 说明 |
|----------|----------|------|
| 爆炸效果太弱 | 增加粒子数量 | 把20改成50 |
| 想加音效 | 加载wav文件 | 碰撞时播放explosion_sound.play() |
| 想加关卡 | 设计关卡系统 | 消灭所有目标后进入下一关 |

---

## 禁忌提醒

- ❌ 音频格式不支持——推荐使用wav或ogg
- ❌ 粒子太多导致卡顿——控制粒子数量和生命周期

---

## 核心知识点

- 音频加载：`pygame.mixer.Sound()` / `pygame.mixer.music`
- 粒子系统：随机方向、速度、颜色
- 碰撞响应：检测到碰撞后触发效果
- 生命周期：粒子逐渐消失

---

## 底层逻辑

- **粒子系统**：大量简单对象模拟复杂效果
- **游戏完整性**：视觉+音效+交互

---

`#执行层` `#测评项`
[UID: PYAI-22-11-001]

---

[上一课](PYAI-2-2-10_举重若轻2.md) | [下一课](PYAI-2-2-12_阶段复习.md) | [返回模块概览](_模块概览.md)
