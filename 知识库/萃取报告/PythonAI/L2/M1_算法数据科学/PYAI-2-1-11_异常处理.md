# [PYAI-2-1-11] 异常处理

> **模块**：L2-M1 算法数据科学
> **认知负荷**：中-高
> **核心技能**：try...except、程序健壮性、常见异常类型
> **UID**：PYAI-21-11-001

---

## 课程基本信息

| 项目 | 内容 |
|------|------|
| **课程编号** | 2-1-11 |
| **课程名称** | 异常处理 |
| **认知负荷** | 中-高 |
| **核心技能** | try...except、程序健壮性、常见异常类型 |
| **项目内容** | 健壮的程序 |

---

## 详细教学流程

**步骤1：知识讲解（25分钟）** `#中负荷-操练` `#IFC-即时`

**教师话术**
> "程序运行时可能出错，比如除以0、文件不存在。如何让程序不崩溃？用**异常处理**！"
>
> "**try...except基础**：
> ```python
> try:
>     # 可能出错的代码
>     result = 10 / 0
> except ZeroDivisionError:
>     # 出错时执行
>     print('不能除以0！')
> ```
>
> **常见异常类型**：
> - `ZeroDivisionError`：除以0
> - `FileNotFoundError`：文件不存在
> - `ValueError`：值错误（如int('abc')）
> - `IndexError`：索引越界
> - `KeyError`：字典键不存在
>
> **捕获多种异常**：
> ```python
> try:
>     num = int(input('输入数字：'))
>     result = 100 / num
> except ValueError:
>     print('请输入有效数字！')
> except ZeroDivisionError:
>     print('不能除以0！')
> except Exception as e:
>     print(f'未知错误：{e}')
> ```
>
> **finally子句**：无论是否出错都执行
> ```python
> try:
>     f = open('data.txt')
>     data = f.read()
> except FileNotFoundError:
>     print('文件不存在')
> finally:
>     f.close()  # 无论如何都关闭文件
> ```"

**步骤2：代码实践（35分钟）** `#高负荷-产出` `#IFC-即时`

**教师话术**
> "让你的程序更健壮：
> 1. 写一个安全的除法函数
> 2. 写一个安全的文件读取函数
> 3. 写一个安全的用户输入函数（只接受数字）"

---

## 变体示例

| 学生情况 | 调整方案 | 说明 |
|----------|----------|------|
| 捕获所有异常 | 警告风险 | `except:`会隐藏真正的bug |
| 想主动抛异常 | 介绍raise | `raise ValueError('错误信息')` |
| 想自定义异常 | 展示class | 高级用法，继承Exception类 |

---

## 核心代码模式

```python
def safe_input(prompt, input_type=int):
    """安全的用户输入函数"""
    while True:
        try:
            value = input_type(input(prompt))
            return value
        except ValueError:
            print(f'请输入有效的{input_type.__name__}类型！')

def safe_divide(a, b):
    """安全的除法函数"""
    try:
        return a / b
    except ZeroDivisionError:
        return None
```

---

## 禁忌提醒

- 空的except——会隐藏所有错误，难以调试
- 捕获Exception太宽泛——应该捕获具体异常
- finally中有return——会覆盖try/except中的return

---

## 核心知识点

- try...except：捕获并处理异常
- 常见异常：ZeroDivisionError, ValueError, FileNotFoundError等
- finally：无论是否出错都执行的清理代码

---

`#执行层` `#测评项`
[UID: PYAI-21-11-001]

---

[上一课](PYAI-2-1-10_文件读写.md) | [下一课](PYAI-2-1-12_阶段复习.md) | [返回模块概览](_模块概览.md)
