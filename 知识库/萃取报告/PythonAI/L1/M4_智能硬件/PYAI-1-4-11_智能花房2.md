# [PYAI-1-4-11] 智能花房(2) - 可视化智能灌溉

> **模块**：L1-M4 智能硬件
> **认知负荷**：高
> **核心技能**：OLED屏幕显示、数据可视化、多传感器融合
> **UID**：PYAI-14-11-001

---

## 课程基本信息

| 项目 | 内容 |
|------|------|
| **课程编号** | PYAI-1-4-11 |
| **课程名称** | 智能花房(2) - 可视化智能灌溉 |
| **认知负荷** | 高 |
| **核心技能** | OLED屏幕显示、数据可视化、多传感器融合 |
| **课时** | 90分钟 |
| **系列** | 智能花房（2/2） |

---

## 详细教学流程

### 步骤1：课程回顾（5分钟）

`#低负荷-热身` `#IFC-预防`

**教师话术**
> "上节课我们做了自动浇水系统。但是，我们只能通过电脑看数据。今天我们要把数据显示在**OLED屏幕**上，让花房更智能！"

---

### 步骤2：知识讲解（15分钟）

`#中负荷-操练` `#IFC-即时`

**教师话术**
> "**OLED屏幕**是一种小型显示屏：
> - 分辨率：128×64像素
> - 可以显示文字、数字、图形
> - 自发光，不需要背光
>
> **显示函数**：
> ```python
> from mpython import *
>
> # 清屏
> oled.fill(0)
>
> # 显示文字（x坐标, y坐标, 内容）
> oled.DispChar('土壤湿度:', 0, 0)
> oled.DispChar('750', 0, 16)
>
> # 显示英文
> oled.DispChar('Soil: 750', 0, 32)
>
> # 更新显示
> oled.show()
> ```
>
> **进度条显示**：
> ```python
> # 画矩形框（x, y, 宽, 高, 颜色）
> oled.rect(0, 50, 128, 10, 1)
>
> # 填充进度（根据湿度百分比）
> progress = int(soil_value / 1024 * 128)
> oled.fill_rect(0, 50, progress, 10, 1)
> ```"

**核心代码模式**

```python
from mpython import *
import time

# 传感器
soil_sensor = Pin(Pin.P0, Pin.IN)
pump = Pin(Pin.P8, Pin.OUT)

DRY_THRESHOLD = 800

def update_display(soil_value, status):
    """更新OLED显示"""
    oled.fill(0)  # 清屏

    # 标题
    oled.DispChar('智能花房', 32, 0)

    # 土壤湿度
    oled.DispChar(f'湿度: {soil_value}', 0, 20)

    # 状态
    oled.DispChar(f'状态: {status}', 0, 36)

    # 进度条
    oled.rect(0, 52, 128, 10, 1)
    progress = min(128, int((1024 - soil_value) / 1024 * 128))
    oled.fill_rect(0, 52, progress, 10, 1)

    oled.show()

while True:
    soil_value = soil_sensor.read_analog()

    if soil_value > DRY_THRESHOLD:
        update_display(soil_value, '浇水中...')
        pump.write_digital(1)
        time.sleep(2)
        pump.write_digital(0)
        update_display(soil_value, '等待渗透')
        time.sleep(30)
    else:
        update_display(soil_value, '湿润正常')

    time.sleep(2)
```

**变体示例**

| 学生情况 | 调整方案 | 说明 |
|----------|----------|------|
| 中文显示乱码 | 检查字体 | 确认使用DispChar而非text |
| 进度条方向反 | 调整计算 | 湿度高时进度条应该长 |
| 想加更多信息 | 分屏显示 | 用按键切换不同页面 |

---

### 步骤3：硬件搭建（20分钟）

`#高负荷-产出` `#IFC-即时`

**教师话术**
> "今天使用板载OLED屏幕，不需要额外接线！
>
> 硬件连接和上节课一样：
> - 土壤湿度传感器 → P0
> - 水泵继电器 → P8
>
> 如果想加入更多传感器：
> - 光线传感器 → 板载
> - 温度传感器 → P1"

---

### 步骤4：编程调试（30分钟）

`#高负荷-产出` `#IFC-即时`

**教师话术**
> "调试重点：
>
> 1. **屏幕显示**：
>    - 文字位置是否合适
>    - 中文是否正常显示
>    - 进度条是否正确
>
> 2. **数据更新**：
>    - 数值是否实时变化
>    - 状态是否正确切换
>
> 3. **整体联调**：
>    - 浇水时屏幕显示'浇水中'
>    - 正常时显示'湿润正常'"

**变体示例**

| 学生情况 | 调整方案 | 说明 |
|----------|----------|------|
| 屏幕闪烁 | 减少刷新频率 | 不要每次循环都清屏 |
| 想加图标 | 用画图函数 | oled.pixel()画点，oled.line()画线 |
| 想记录历史 | 用列表存储 | 保存最近10次的数值 |

---

### 步骤5：成果展示（10分钟）

`#低负荷-热身` `#IFC-复盘`

**教师话术**
> "谁的可视化花房做好了？展示一下你的屏幕界面！
>
> 挑战：能不能加入更多功能？
> - 显示当前时间
> - 显示累计浇水次数
> - 显示光照强度"

---

## 核心知识点

- OLED显示：`oled.DispChar()` 显示文字
- 清屏和更新：`oled.fill(0)` + `oled.show()`
- 进度条：`oled.rect()` 画框 + `oled.fill_rect()` 填充
- 数据可视化：把数值转换为图形

---

## 底层逻辑

- **人机交互**：数据 → 可视化 → 用户理解
- **系统集成**：传感器 + 执行器 + 显示器

---

`#执行层` `#测评项`
[UID: PYAI-14-11-001]

---

[上一课](PYAI-1-4-10_智能花房1.md) | [返回模块](_模块概览.md) | [下一课](PYAI-1-4-12_家居回顾.md)
