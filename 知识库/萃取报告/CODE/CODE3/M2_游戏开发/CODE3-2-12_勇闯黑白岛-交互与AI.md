# [CODE3-2-12] 勇闯黑白岛-交互与AI

> **模块**：M2 游戏开发
> **认知负荷**：高
> **核心技能**：NPC对话、敌人巡逻AI、机关陷阱
> **UID**：CODE3-M2-12-001

---

## 课程基本信息

| 项目 | 内容 |
|------|------|
| **课程编号** | 3-2-12 |
| **课程名称** | 勇闯黑白岛-交互与AI |
| **认知负荷** | 高 |
| **核心技能** | NPC对话、敌人巡逻AI、机关陷阱 |
| **所属项目** | 项目四：勇闯黑白岛（第10-12课） |

---

## 详细教学流程

### 步骤1：项目回顾（5分钟）

`#低负荷-热身` `#IFC-预防`

**教师话术**
> "我们的勇闯黑白岛已经有了重力和卷轴地图！今天是最后一课，我们要让游戏更有趣——加入NPC对话、敌人AI和机关陷阱！"

---

### 步骤2：任务分析（15分钟）

`#中负荷-操练` `#IFC-即时` ⭐核心环节

**教师话术**
> "今天要做三个功能：
>
> 1. **NPC对话**：遇到村民，按空格键可以对话
> 2. **敌人AI**：怪物会来回巡逻，碰到就掉血
> 3. **机关陷阱**：踩到陷阱会触发机关
>
> 先来看NPC对话的逻辑：
> - 主角靠近NPC时，显示'按空格对话'提示
> - 按空格后，NPC说出对话内容
> - 对话可以用列表存储多句话
>
> 敌人AI的逻辑：
> - 敌人在两个点之间来回走动（巡逻）
> - 碰到边界就转向
> - 碰到主角就造成伤害"

**变体示例**

| 学生情况 | 调整方案 | 说明 |
|----------|----------|------|
| 对话太简单 | 添加选项 | 玩家可以选择回答 |
| 敌人太难 | 减慢速度 | 敌人移动速度降低 |
| 想增加功能 | 添加商店 | NPC可以买卖道具 |

**核心代码模式**
```
// NPC对话系统
当绿旗被点击
将 [对话列表] 设为 [你好，勇士！|前方有危险！|小心那些怪物！|祝你好运！]
将 [当前对话] 设为 (0)
隐藏变量 [对话提示]
重复执行
  如果 <碰到 [主角] ?> 那么
    显示变量 [对话提示]
    将 [对话提示] 设为 [按空格对话]
    如果 <按下 [空格] 键?> 那么
      将 [当前对话] 增加 (1)
      如果 <(当前对话) > (4)> 那么
        将 [当前对话] 设为 (1)
      结束
      说 (第 (当前对话) 项 [对话列表]) (2) 秒
      等待 (0.5) 秒
    结束
  否则
    隐藏变量 [对话提示]
  结束
结束

// 敌人巡逻AI
当绿旗被点击
将 [巡逻方向] 设为 (1)  // 1=向右，-1=向左
将 [左边界] 设为 (-100)
将 [右边界] 设为 (100)
重复执行
  // 巡逻移动
  将 x 增加 ((巡逻方向) * 2)
  // 到达边界就转向
  如果 <(x) > (右边界)> 那么
    将 [巡逻方向] 设为 (-1)
    面向 (-90) 度  // 面向左
  结束
  如果 <(x) < (左边界)> 那么
    将 [巡逻方向] 设为 (1)
    面向 (90) 度   // 面向右
  结束
  // 碰到主角造成伤害
  如果 <碰到 [主角] ?> 那么
    广播 [主角受伤]
    等待 (1) 秒  // 无敌时间
  结束
结束

// 机关陷阱
当绿旗被点击
将造型设为 [隐藏]
重复执行
  如果 <碰到 [主角] ?> 那么
    将造型设为 [触发]
    播放声音 [陷阱]
    广播 [陷阱触发]
    等待 (0.5) 秒
    // 发射飞镖或落石
    克隆 [飞镖]
    等待 (2) 秒
    将造型设为 [隐藏]
  结束
结束

// 主角受伤处理
当收到 [主角受伤]
将 [生命值] 增加 (-1)
将 [虚像] 特效设为 (50)  // 闪烁效果
等待 (0.2) 秒
清除图形特效
如果 <(生命值) <= (0)> 那么
  广播 [游戏结束]
结束
```

---

### 步骤3：游戏完善（15分钟）

`#高负荷-产出` `#IFC-即时`

**教师话术**
> "最后我们来完善游戏：
> 1. **生命值系统**：用爱心显示剩余生命
> 2. **胜利条件**：到达终点旗帜就胜利
> 3. **开始/结束界面**：让游戏更完整"

**核心代码模式**
```
// 胜利判定
当绿旗被点击
重复执行
  如果 <碰到 [终点旗帜] ?> 那么
    广播 [游戏胜利]
    停止 [全部]
  结束
结束

// 游戏胜利界面
当收到 [游戏胜利]
播放声音 [胜利]
说 [恭喜通关！] (3) 秒
```

---

### 步骤4：家长班会（10分钟）

`#低负荷-热身` `#IFC-复盘`

**教师话术**
> "各位家长大家好！勇闯黑白岛项目完成了！这是一个完整的平台跳跃游戏，三节课下来，孩子们学会了：
> 1. **重力引擎**：物理模拟，让角色能跳跃和下落
> 2. **卷轴地图**：相对运动，创造无限大的游戏世界
> 3. **游戏AI**：敌人巡逻、NPC对话、机关陷阱
>
> 整个CODE3-2单元，孩子们完成了四个大型游戏项目：
> - 太空防卫战：克隆、变量、冷却机制
> - 篮球小子：状态机、抛物线算法
> - 植物大战僵尸：列表、网格对齐、射线检测
> - 勇闯黑白岛：重力引擎、卷轴地图、敌人AI
>
> 这些都是专业游戏开发的核心技术！孩子们已经具备了独立设计和开发游戏的能力！"

---

## 核心知识点

- NPC对话：靠近触发、按键交互、列表存储对话
- 敌人巡逻AI：边界检测、方向切换、伤害判定
- 机关陷阱：触发检测、状态切换、克隆发射
- 生命值系统：变量管理、受伤反馈、游戏结束

---

## 底层逻辑

- **游戏AI**：用简单规则模拟智能行为
- **状态管理**：用变量记录游戏各种状态
- **完整性**：开始、游戏、结束的完整流程

---

## 导航

- **上一课**：[CODE3-2-11 勇闯黑白岛-卷轴地图](CODE3-2-11_勇闯黑白岛-卷轴地图.md)
- **下一课**：[CODE3-3-01 高级工程入门](../M3_高级工程/CODE3-3-01_高级工程入门.md)
- **模块概览**：[M2 游戏开发](_模块概览.md)

---

`#执行层` `#测评项`
[UID: CODE3-M2-12-001]
