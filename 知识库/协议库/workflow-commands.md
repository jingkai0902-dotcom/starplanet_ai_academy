# 工作流命令协议

> **用途**：定义用户下达任务的标准命令格式，确保AI正确调用脚本和协议。
> **创建日期**：2026-01-24
> **版本**：V1.0

---

## 一、素材预处理命令

### 命令格式

```
素材预处理：[级别名称]
路径：[文件夹完整路径]
输出：[输出文件夹路径，可选]
选项：[可选参数]
```

### 参数说明

| 参数 | 必填 | 说明 | 示例 |
|------|------|------|------|
| 级别名称 | 是 | 课程级别标识 | K1、K2、G0、G1、SS1 |
| 路径 | 是 | 原始素材文件夹的完整路径 | `C:\Users\Frank.J\Desktop\励步\K1` |
| 输出 | 否 | 输出目录，默认为 `dehydrated_[级别]/` | `C:\输出目录` |
| 选项 | 否 | 附加选项（见下表） | `保留原文件` |

### 可选参数

| 选项 | 说明 |
|------|------|
| `保留原文件` | 不删除原音视频文件 |
| `跳过转录` | 不执行音视频转录（仅处理PDF/Word） |
| `仅扫描` | 只生成文件清单，不实际处理 |

### 示例

```
素材预处理：K1
路径：C:\Users\Frank.J\Desktop\励步\新整理的材料\K1
```

```
素材预处理：G2
路径：D:\励步教材\G2
输出：C:\Users\Frank.J\libu_knowledge\dehydrated_G2
选项：保留原文件
```

### 执行流程

收到此命令后，AI将按顺序执行：

| 步骤 | 动作 | 脚本/工具 |
|------|------|----------|
| 1 | 扫描文件结构 | `material_manager.py index` |
| 2 | 检测重复文件 | `material_manager.py dup` |
| 3 | **确认**：是否删除重复文件 | 等待用户确认 |
| 4 | 音视频转录 | `dehydrator.py --transcribe` |
| 5 | **确认**：是否删除原音视频 | 等待用户确认 |
| 6 | 生成索引文档 | 自动生成 `[级别]_INDEX.md` |
| 7 | 扁平化输出 | 输出到 `dehydrated_[级别]/` |
| 8 | 汇报完成状态 | 输出统计信息 |

### 输出产物

```
dehydrated_[级别]/
├── [级别]_U1.md      # Unit 1 脱水文档
├── [级别]_U2.md      # Unit 2 脱水文档
├── ...
├── [级别]_INDEX.md   # 汇总索引
└── [级别]_DUPLICATES.md  # 重复文件报告（如有）
```

---

## 二、深度萃取命令

### 命令格式

```
深度萃取：[级别名称]
笔记本：[NotebookLM链接]
断点：[可选，从第几个来源继续]
```

### 参数说明

| 参数 | 必填 | 说明 | 示例 |
|------|------|------|------|
| 级别名称 | 是 | 课程级别标识 | K1、G0、SS2 |
| 笔记本 | 是 | NotebookLM笔记本URL | `https://notebooklm.google.com/notebook/xxx` |
| 断点 | 否 | 从指定来源序号继续（用于中断恢复） | `从第21个来源继续` |

### 示例

```
深度萃取：K1
笔记本：https://notebooklm.google.com/notebook/a1b2c3d4-xxxx
```

```
深度萃取：G1
笔记本：https://notebooklm.google.com/notebook/xxxxx
断点：从第21个来源继续
```

### 执行流程

收到此命令后，AI将按顺序执行：

| 步骤 | 动作 | 加载文档 |
|------|------|---------|
| 1 | 加载萃取规则 | `知识库萃取标准与执行规则.md` |
| 2 | 加载分批协议 | `协议库/batch-processing.md` |
| 3 | 访问笔记本 | 通过NotebookLM链接 |
| 4 | 识别来源数量 | 统计笔记本中的来源总数 |
| 5 | 按5-5循环萃取 | 每批5个来源，逐批处理 |
| 6 | 输出萃取报告 | `萃取报告/[级别]级别深��萃取报告.md` |
| 7 | 更新QUICKSTART | 记录完成状态 |

### 萃取过程中的确认点

| 确认点 | 时机 | 用户操作 |
|--------|------|---------|
| 来源确认 | 开始前 | 确认来源数量和分批计划 |
| 批次完成 | 每5个来源后 | 可选择继续或暂停 |
| 最终确认 | 全部完成后 | 确认报告内容 |

### 输出产物

```
知识库/萃取报告/
└── [级别]级别深度萃取报告.md
```

---

## 三、快捷命令

### 单步命令

| 命令 | 说明 | 等效操作 |
|------|------|---------|
| `查重：[路径]` | 仅执行重复文件检测 | `material_manager.py dup` |
| `转录：[路径]` | 仅执行音视频转录 | `dehydrator.py --transcribe` |
| `索引：[路径]` | 仅生成文件索引 | `material_manager.py index` |
| `导出JSON：[报告路径]` | 导出萃取报告为JSON | `json_exporter.py` |

### 查询命令

| 命令 | 说明 |
|------|------|
| `当前进度` | 显示QUICKSTART.md中的进度状态 |
| `待办任务` | 显示待完成任务列表 |
| `脚本帮助` | 显示所有脚本的使用方法 |

---

## 四、注意事项

### 路径格式

- Windows路径使用反斜杠或正斜杠均可
- 路径中有空格时无需加引号
- 示例：`C:\Users\Frank.J\Desktop\励步` 或 `C:/Users/Frank.J/Desktop/励步`

### 中断恢复

如果萃取过程中断，使用断点参数恢复：
```
深度萃取：K1
笔记本：[链接]
断点：从第21个来源继续
```

### 依赖检查

首次使用音视频转录前，需安装whisper：
```bash
pip install openai-whisper
```

---

## 更新日志

| 版本 | 日期 | 更新内容 |
|------|------|---------|
| V1.0 | 2026-01-24 | 初版：定义素材预处理、深度萃取两大命令格式 |
