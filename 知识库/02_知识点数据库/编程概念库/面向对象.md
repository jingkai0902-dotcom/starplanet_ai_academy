# 面向对象编程

> **用途**：跨课程面向对象编程（OOP）概念详细说明
> **更新日期**：2026-02-10
> **数据来源**：萃取报告/PythonAI/
> **整合原则**：基于现有萃取报告，不压缩删减

---

## 一、面向对象基础

### 概念定义
面向对象编程（OOP）是一种编程范式，将数据和操作数据的方法封装在一起，形成"对象"。通过类（Class）定义对象的模板，通过实例化创建具体的对象。

### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 2-2-1 | class定义 | 实例创建、self、__init__ |
| PYAI 2-2-3 | 类实例应用 | Pygame综合 |
| PYAI 2-2-6 | 类属性控制 | 随机模块、for循环高级用法 |
| MP1-L4 | 类与实例(1) | OOP基础 |
| MP1-L5 | 类与实例(2) | self和__init__ |

---

## 二、类的定义与实例化

### 2.1 基本类定义

```python
# 定义一个简单的类
class Dog:
    pass  # 空类

# 创建实例
my_dog = Dog()
```

### 2.2 带属性的类

```python
class Dog:
    def __init__(self, name, age):
        self.name = name    # 实例属性
        self.age = age      # 实例属性

# 创建实例
dog1 = Dog("旺财", 3)
dog2 = Dog("小黑", 5)

# 访问属性
print(dog1.name)  # 输出: 旺财
print(dog2.age)   # 输出: 5
```

### 教学要点
- 类是"模板"，实例是"具体对象"
- 用饼干模具比喻：类是模具，饼干是实例
- 每个实例有自己独立的属性值

---

## 三、self关键字

### 概念定义
`self`代表类的实例本身，用于在类的方法中访问实例的属性和其他方法。

### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 2-2-1 | self | 实例自身引用 |
| MP1-L5 | self | 类方法中的self |

### Python示例
```python
class Dog:
    def __init__(self, name):
        self.name = name    # self.name是实例属性

    def bark(self):
        print(f"{self.name}在叫: 汪汪!")

    def introduce(self):
        print(f"我是{self.name}")

# 使用
dog = Dog("旺财")
dog.bark()        # 输出: 旺财在叫: 汪汪!
dog.introduce()   # 输出: 我是旺财
```

### 教学要点
- `self`是方法的第一个参数，但调用时不需要传递
- `self.属性名`访问实例属性
- `self.方法名()`调用实例方法

---

## 四、__init__方法

### 概念定义
`__init__`是构造方法，在创建实例时自动调用，用于初始化实例的属性。

### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 2-2-1 | __init__ | 构造方法 |
| MP1-L5 | __init__ | 初始化方法 |

### Python示例
```python
class Player:
    def __init__(self, name, health=100):
        self.name = name
        self.health = health
        self.score = 0      # 默认值
        print(f"玩家 {name} 已创建!")

# 创建实例时自动调用__init__
player1 = Player("勇士")        # 输出: 玩家 勇士 已创建!
player2 = Player("法师", 80)    # 输出: 玩家 法师 已创建!

print(player1.health)  # 100（默认值）
print(player2.health)  # 80（传入的值）
```

---

## 五、实例方法

### 概念定义
定义在类中的函数，用于操作实例的属性或执行特定行为。

### Python示例
```python
class Player:
    def __init__(self, name, health=100):
        self.name = name
        self.health = health
        self.is_alive = True

    def take_damage(self, damage):
        """受到伤害"""
        self.health -= damage
        print(f"{self.name}受到{damage}点伤害，剩余血量: {self.health}")
        if self.health <= 0:
            self.die()

    def heal(self, amount):
        """治疗"""
        self.health += amount
        print(f"{self.name}恢复{amount}点血量，当前血量: {self.health}")

    def die(self):
        """死亡"""
        self.is_alive = False
        print(f"{self.name}已阵亡!")

# 使用
player = Player("勇士")
player.take_damage(30)   # 勇士受到30点伤害，剩余血量: 70
player.heal(20)          # 勇士恢复20点血量，当前血量: 90
player.take_damage(100)  # 勇士受到100点伤害，剩余血量: -10
                         # 勇士已阵亡!
```

---

## 六、类在游戏开发中的应用

### 6.1 Pygame中的类应用

#### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 2-2-3 | 弹幕类 | `class Danmaku:` |
| PYAI 2-2-6 | 星星类 | 类属性控制 |
| PYAI 2-2-7 | 游戏角色类 | 按键交互、碰撞检测 |

#### 弹幕游戏示例
```python
import pygame
import random

class Danmaku:
    def __init__(self, text, y):
        self.text = text
        self.x = 800           # 从右边开始
        self.y = y
        self.speed = random.randint(2, 5)
        self.color = (random.randint(0, 255),
                      random.randint(0, 255),
                      random.randint(0, 255))

    def update(self):
        """更新位置"""
        self.x -= self.speed

    def draw(self, screen, font):
        """绘制弹幕"""
        text_surface = font.render(self.text, True, self.color)
        screen.blit(text_surface, (self.x, self.y))

    def is_off_screen(self):
        """检查是否离开屏幕"""
        return self.x < -200

# 使用
danmakus = []
danmakus.append(Danmaku("Hello!", 100))
danmakus.append(Danmaku("World!", 200))

# 游戏循环中
for danmaku in danmakus[:]:
    danmaku.update()
    danmaku.draw(screen, font)
    if danmaku.is_off_screen():
        danmakus.remove(danmaku)
```

### 6.2 星星类示例

```python
import pygame
import random

class Star:
    def __init__(self):
        self.x = random.randint(0, 800)
        self.y = random.randint(0, 600)
        self.size = random.randint(1, 3)
        self.speed = random.uniform(0.5, 2)
        self.brightness = random.randint(100, 255)

    def update(self):
        """星星闪烁效果"""
        self.brightness += random.randint(-10, 10)
        self.brightness = max(100, min(255, self.brightness))

    def draw(self, screen):
        color = (self.brightness, self.brightness, self.brightness)
        pygame.draw.circle(screen, color, (int(self.x), int(self.y)), self.size)

# 创建100颗星星
stars = [Star() for _ in range(100)]

# 游戏循环中
for star in stars:
    star.update()
    star.draw(screen)
```

---

## 七、MicroPython中的类应用

### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| MP1-L6 | 硬件驱动封装 | NovaMP库使用 |

### NovaMP库类示例
```python
from novaMP import LED, Button, SG90

# LED类使用
led = LED(2)
led.test()              # 测试方法
led.fill((255, 0, 0))   # 设置颜色
led.write()             # 更新显示

# Button类使用
button = Button(4)
if button.is_pressed():
    print("按钮被按下")

# SG90舵机类使用
servo = SG90(5)
servo.angle(90)         # 转到90度
```

### 自定义硬件类
```python
class SmartLight:
    def __init__(self, led_pin, sensor_pin):
        self.led = LED(led_pin)
        self.sensor = ADC(Pin(sensor_pin))
        self.threshold = 500

    def auto_control(self):
        """根据光线自动控制"""
        light_value = self.sensor.read()
        if light_value < self.threshold:
            self.led.fill((255, 255, 255))  # 开灯
        else:
            self.led.fill((0, 0, 0))        # 关灯
        self.led.write()

# 使用
smart_light = SmartLight(4, 34)
while True:
    smart_light.auto_control()
    time.sleep(0.5)
```

---

## 八、类的进阶概念

### 8.1 类属性 vs 实例属性

```python
class Player:
    # 类属性（所有实例共享）
    game_name = "冒险游戏"
    player_count = 0

    def __init__(self, name):
        # 实例属性（每个实例独有）
        self.name = name
        Player.player_count += 1

# 类属性通过类名访问
print(Player.game_name)  # 冒险游戏

# 创建实例
p1 = Player("勇士")
p2 = Player("法师")

print(Player.player_count)  # 2（类属性被修改）
print(p1.name)              # 勇士（实例属性）
print(p2.name)              # 法师（实例属性）
```

### 8.2 私有属性（约定）

```python
class BankAccount:
    def __init__(self, balance):
        self._balance = balance  # 单下划线：约定为私有

    def deposit(self, amount):
        if amount > 0:
            self._balance += amount

    def get_balance(self):
        return self._balance

account = BankAccount(1000)
account.deposit(500)
print(account.get_balance())  # 1500
```

---

## 九、OOP进阶路线

```
PYAI 2-2-1          MP1-L4/L5          PYAI 2-2-3          PYAI 2-2-6
class定义    →      self/__init__  →   类实例应用    →     类属性控制
   ↓                    ↓                  ↓                   ↓
 类模板             初始化方法          游戏对象            共享属性
```

---

## 十、常见错误与禁忌

| 错误 | 后果 | 正确做法 |
|------|------|---------|
| ❌ 忘记self参数 | TypeError | 方法第一个参数必须是self |
| ❌ 忘记self.访问属性 | NameError | 用self.属性名访问实例属性 |
| ❌ __init__写成__init | 不会自动调用 | 注意双下划线 |
| ❌ 修改类属性影响所有实例 | 意外行为 | 区分类属性和实例属性 |
| ❌ 在类外直接访问私有属性 | 破坏封装 | 通过方法访问 |

### 常见错误示例
```python
# ❌ 错误：忘记self
class Dog:
    def __init__(name):  # 缺少self
        name = name      # 这是局部变量，不是实例属性

# ✅ 正确
class Dog:
    def __init__(self, name):
        self.name = name

# ❌ 错误：忘记self.
class Dog:
    def __init__(self, name):
        self.name = name

    def bark(self):
        print(f"{name}在叫")  # NameError: name未定义

# ✅ 正确
class Dog:
    def __init__(self, name):
        self.name = name

    def bark(self):
        print(f"{self.name}在叫")  # 使用self.name
```

---

**维护者**：知识库管理员
**数据来源**：萃取报告/PythonAI/
**整合原则**：基于现有萃取报告，不压缩删减
