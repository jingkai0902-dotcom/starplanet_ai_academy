# 函数与封装

> **用途**：跨课程函数与封装概念详细说明
> **更新日期**：2026-02-10
> **数据来源**：萃取报告/CODE/、萃取报告/PythonAI/
> **整合原则**：基于现有萃取报告，不压缩删减

---

## 一、函数基础

### 概念定义
函数是一段可重复使用的代码块，用于完成特定任务。通过函数可以实现代码复用，提高程序的可读性和可维护性。

### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| CODE1-4-08 | 自制积木（函数） | 定义与调用 |
| PYAI 1-1-1 | 函数定义 | `def attack_enemy():` |

---

## 二、函数定义与调用

### 2.1 Scratch自制积木

#### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| CODE1-4-08 | 自制积木 | 代码复用 |

#### Scratch示例
```
定义 画正方形
    重复 4 次
        移动 100 步
        右转 90 度

当绿旗被点击
画正方形
画正方形
画正方形
```

### 2.2 Python函数定义

#### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 1-1-1 | 函数定义 | `def function_name():` |

#### Python示例
```python
# 定义函数
def attack_enemy():
    hero.attack(enemy)

# 调用函数
attack_enemy()
attack_enemy()
attack_enemy()
```

### 教学要点
- 函数是"工具"，定义一次，使用多次
- 函数名要有意义，描述函数的功能
- 先定义，后调用

---

## 三、参数传递

### 3.1 形式参数与实际参数

#### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 1-1-2 | 形式参数 | `def attack_target(target):` |
| PYAI 1-1-4 | 多参数函数 | `def move_and_attack(x, y, target):` |

#### Python示例
```python
# 形式参数（定义时）
def greet(name):        # name是形式参数
    print(f"你好，{name}！")

# 实际参数（调用时）
greet("张三")           # "张三"是实际参数
greet("李四")           # "李四"是实际参数
```

### 3.2 位置参数

#### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 1-1-4 | 位置参数 | 按顺序传递参数 |

#### Python示例
```python
def draw_rectangle(width, height):
    print(f"宽: {width}, 高: {height}")

# 位置参数按顺序匹配
draw_rectangle(100, 50)   # width=100, height=50
draw_rectangle(50, 100)   # width=50, height=100（顺序不同，结果不同）
```

### 3.3 默认参数

#### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 1-1-5 | 默认参数 | `def greet(name='Friend'):` |

#### Python示例
```python
def greet(name='朋友'):
    print(f"你好，{name}！")

greet()           # 输出: 你好，朋友！（使用默认值）
greet("张三")     # 输出: 你好，张三！（覆盖默认值）
```

### 3.4 绘图函数参数应用

#### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 1-1-3 | 绘图指令 | `def draw_polygon(sides, length):` |

#### Python示例
```python
import turtle

def draw_polygon(sides, length):
    """绘制正多边形"""
    angle = 360 / sides
    for i in range(sides):
        turtle.forward(length)
        turtle.right(angle)

# 调用绘制不同图形
draw_polygon(3, 100)   # 三角形
draw_polygon(4, 100)   # 正方形
draw_polygon(6, 80)    # 六边形
```

---

## 四、返回值

### 概念定义
函数可以通过`return`语句返回一个值给调用者。

### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 1-2-3 | 返回值(return) | 利息计算模型 |

### Python示例
```python
# 无返回值的函数
def say_hello():
    print("Hello!")

# 有返回值的函数
def add(a, b):
    return a + b

# 使用返回值
result = add(3, 5)
print(result)  # 输出: 8

# 实际应用：计算利息
def calculate_interest(principal, rate, years):
    interest = principal * rate * years
    return interest

my_interest = calculate_interest(10000, 0.05, 3)
print(f"利息: {my_interest}")  # 输出: 利息: 1500.0
```

### 教学要点
- `return`会立即结束函数执行
- 没有`return`的函数返回`None`
- 返回值可以是任何类型（数字、字符串、列表等）

---

## 五、事件与回调函数

### 概念定义
事件驱动编程中，当特定事件发生时，自动调用预先定义的函数。

### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| CODE1-3-01 | 事件驱动 | 当绿旗被点击、当按下按键 |
| CODE1-4-05 | 广播消息 | 角色间通信 |
| PYAI 1-1-6 | 事件监听 | `pet.on('hear', speak)` |

### Scratch示例
```
当绿旗被点击
    说 "游戏开始！"

当按下 [空格键]
    跳跃

当收到 [游戏结束 v]
    说 "Game Over"
```

### Python示例
```python
# 事件监听（CodeCombat风格）
def on_hear(event):
    pet.say(event.message)

pet.on('hear', on_hear)

# Pygame事件处理
import pygame

def handle_events():
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            return False
        if event.type == pygame.KEYDOWN:
            if event.key == pygame.K_SPACE:
                player.jump()
    return True
```

---

## 六、输入输出函数

### 6.1 input()函数

#### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| CODE1-4-06 | 人机交互 | 询问...并等待、回答 |
| PYAI 1-1-8 | input输入 | `age = int(input('年龄:'))` |

#### Scratch示例
```
询问 [你叫什么名字？] 并等待
说 (字符串连接 [你好，] 和 (回答))
```

#### Python示例
```python
# 基本输入
name = input("请输入你的名字: ")
print(f"你好，{name}！")

# 输入数字（需要类型转换）
age = int(input("请输入你的年龄: "))
price = float(input("请输入价格: "))
```

### 6.2 print()函数

#### Python示例
```python
# 基本输出
print("Hello, World!")

# 格式化输出
name = "张三"
score = 95
print(f"{name}的成绩是{score}分")

# 多个值输出
print("姓名:", name, "成绩:", score)

# 不换行输出
print("Loading", end="")
print("...", end="")
print("Done!")  # 输出: Loading...Done!
```

---

## 七、递归函数

### 概念定义
函数调用自身的编程技巧，用于解决可以分解为相同子问题的问题。

### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 2-1-3 | 递归函数 | 递归终止条件、调用栈 |
| PYAI 2-1-4 | 递归应用 | 分治思想、汉诺塔 |

### Python示例
```python
# 阶乘（经典递归）
def factorial(n):
    if n <= 1:          # 终止条件
        return 1
    return n * factorial(n - 1)  # 递归调用

print(factorial(5))  # 输出: 120

# 汉诺塔
def hanoi(n, source, auxiliary, target):
    if n == 1:
        print(f"移动盘子从 {source} 到 {target}")
        return
    hanoi(n - 1, source, target, auxiliary)
    print(f"移动盘子从 {source} 到 {target}")
    hanoi(n - 1, auxiliary, source, target)

hanoi(3, 'A', 'B', 'C')
```

### 教学要点
- 必须有终止条件，否则无限递归
- 用俄罗斯套娃比喻递归
- 递归深度有限制（Python默认1000层）

---

## 八、模块导入

### 概念定义
将其他文件中的函数导入到当前程序中使用。

### 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 2-1-1 | import模块导入 | `import math` |
| PYAI 2-1-2 | turtle模块 | `import turtle` |
| PYAI 2-1-7 | matplotlib | `import matplotlib.pyplot as plt` |

### Python示例
```python
# 导入整个模块
import math
print(math.sqrt(16))  # 4.0

# 导入特定函数
from math import sqrt, pi
print(sqrt(16))       # 4.0
print(pi)             # 3.14159...

# 导入并重命名
import matplotlib.pyplot as plt
plt.plot([1, 2, 3], [1, 4, 9])
plt.show()

# 导入自定义模块
from my_module import my_function
```

---

## 九、函数进阶路线

```
CODE1-4-08          PYAI 1-1-1          PYAI 1-1-2          PYAI 1-2-3          PYAI 2-1-3
自制积木     →      def函数      →      带参数函数    →     返回值       →      递归函数
   ↓                   ↓                   ↓                   ↓                   ↓
 代码复用           函数定义            参数传递            return             自我调用
```

---

## 十、Scratch → Python 映射

| Scratch | Python | 说明 |
|---------|--------|------|
| 定义 [自制积木] | `def function_name():` | 函数定义 |
| 自制积木 | `function_name()` | 函数调用 |
| 定义 [积木] (参数1) | `def func(param):` | 带参数函数 |
| 询问...并等待 | `input("...")` | 用户输入 |
| 回答 | 变量存储input返回值 | 获取输入值 |
| 广播 [消息] | 事件/回调函数 | 消息传递 |

---

## 十一、常见错误与禁忌

| 错误 | 后果 | 正确做法 |
|------|------|---------|
| ❌ 函数定义后忘记调用 | 函数不执行 | 定义后要调用 |
| ❌ 参数顺序错误 | 结果错误 | 注意参数顺序 |
| ❌ 忘记return | 返回None | 需要返回值时加return |
| ❌ 递归无终止条件 | 栈溢出 | 必须有终止条件 |
| ❌ 修改全局变量忘记global | 创建局部变量 | 使用global声明 |

---

**维护者**：知识库管理员
**数据来源**：萃取报告/CODE/、萃取报告/PythonAI/
**整合原则**：基于现有萃取报告，不压缩删减
