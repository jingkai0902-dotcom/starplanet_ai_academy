# 物理仿真数学

> **用途**：物理仿真相关数学在各课程中的应用详解
> **更新日期**：2026-02-10
> **数据来源**：萃取报告/CODE/、萃取报告/PythonAI/

---

## 一、距离公式

### 1.1 两点间距离

```
距离 = √((x2-x1)² + (y2-y1)²)
```

### 1.2 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 1-2-1 | 天涯明月 | 圆形碰撞检测 |
| PYAI 1-1-11 | 碰撞检测 | distanceTo方法 |
| CODE3-2-02 | 太空防卫战 | 子弹与敌机距离 |

### 1.3 Python实现

```python
import math

def distance(x1, y1, x2, y2):
    """计算两点间距离"""
    return math.sqrt((x2 - x1)**2 + (y2 - y1)**2)

# 示例
d = distance(0, 0, 3, 4)  # 5.0（勾股定理：3-4-5）
```

### 1.4 Scratch实现

```scratch
// 计算与鼠标的距离
将 [距离] 设为 ([sqrt] 的 ((((鼠标的 x 座标) - (x 座标)) * ((鼠标的 x 座标) - (x 座标))) + (((鼠标的 y 座标) - (y 座标)) * ((鼠标的 y 座标) - (y 座标)))))
```

### 1.5 教学话术

> "两点之间的距离怎么算？想象一个直角三角形，两点的连线是斜边。用勾股定理：斜边² = 横边² + 竖边²。"

---

## 二、速度与加速度

### 2.1 基本公式

```
位置 = 位置 + 速度
速度 = 速度 + 加速度
```

### 2.2 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| CODE2-2-06 | 测速试验车 | 速度=距离/时间 |
| CODE3-2-10 | 勇闯黑白岛 | 重力加速度 |
| PYAI 2-2-10 | 举重若轻2 | 物理引擎基础 |

### 2.3 Python物理更新

```python
class PhysicsObject:
    def __init__(self, x, y):
        self.x = x
        self.y = y
        self.vx = 0  # 水平速度
        self.vy = 0  # 垂直速度
        self.ax = 0  # 水平加速度
        self.ay = 0  # 垂直加速度（重力）

    def update(self):
        """每帧更新"""
        # 速度 += 加速度
        self.vx += self.ax
        self.vy += self.ay
        # 位置 += 速度
        self.x += self.vx
        self.y += self.vy
```

### 2.4 Scratch物理更新

```scratch
// 重力效果
将 [Y速度] 改变 (-0.5)
将 y 改变 (Y速度)

// 水平移动
将 x 改变 (X速度)
```

---

## 三、重力与抛物线

### 3.1 抛物线运动

```
水平方向：匀速运动（无加速度）
垂直方��：匀加速运动（重力加速度）
```

### 3.2 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| CODE3-2-04 | 篮球小子-投篮物理 | 抛物线轨迹 |
| CODE3-2-05 | 篮球小子-力度与角度 | 速度分解 |
| CODE3-2-10 | 勇闯黑白岛-重力引擎 | 跳跃物理 |

### 3.3 速度分解

```python
import math

def launch(speed, angle_deg):
    """根据速度和角度计算初始速度分量"""
    angle_rad = math.radians(angle_deg)
    vx = speed * math.cos(angle_rad)  # 水平速度（恒定）
    vy = speed * math.sin(angle_rad)  # 垂直速度（受重力影响）
    return vx, vy

# 示例：以50的速度、45度角发射
vx, vy = launch(50, 45)
print(f"水平速度: {vx:.2f}, 垂直速度: {vy:.2f}")
# 水平速度: 35.36, 垂直速度: 35.36
```

### 3.4 完整抛物线模拟

```python
import math

class Projectile:
    def __init__(self, x, y, speed, angle):
        self.x = x
        self.y = y
        angle_rad = math.radians(angle)
        self.vx = speed * math.cos(angle_rad)
        self.vy = speed * math.sin(angle_rad)
        self.gravity = 0.5

    def update(self):
        """每帧更新"""
        self.vy -= self.gravity  # 重力减速（向上为正）
        self.x += self.vx
        self.y += self.vy

    def is_on_ground(self, ground_y=0):
        """检查是否落地"""
        return self.y <= ground_y
```

### 3.5 Scratch抛物线

```scratch
// 初始化
将 [X速度] 设为 ((力度) * ([cos] 的 (角度)))
将 [Y速度] 设为 ((力度) * ([sin] 的 (角度)))

// 飞行循环
重复执行直到 <碰到 [地面]>
    将 x 改变 (X速度)
    将 y 改变 (Y速度)
    将 [Y速度] 改变 (-0.5)  // 重力
```

### 3.6 教学话术

> "抛物线运动就像扔石头。水平方向没有力，所以匀速前进；垂直方向有重力，所以先上升后下降。我们用sin和cos把斜着的速度分解成横向和纵向。"

---

## 四、碰撞检测

### 4.1 圆形碰撞

```
两圆相撞条件：圆心距离 < 两圆半径之和
```

### 4.2 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 1-2-1 | 天涯明月 | 圆形碰撞公式 |
| CODE3-2-02 | 太空防卫战 | 子弹碰撞检测 |

### 4.3 Python圆形碰撞

```python
import math

def circle_collision(x1, y1, r1, x2, y2, r2):
    """检测两圆是否碰撞"""
    dist = math.sqrt((x2 - x1)**2 + (y2 - y1)**2)
    return dist < r1 + r2

# 示例
hit = circle_collision(0, 0, 10, 15, 0, 10)  # True（距离15 < 半径和20）
```

### 4.4 矩形碰撞(AABB)

```
两矩形相撞条件：X轴重叠 且 Y轴重叠
```

### 4.5 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 1-2-2 | 令行禁止 | AABB碰撞检测 |
| CODE3-2-08 | 植物大战僵尸-射手与子弹 | 子弹与僵尸碰撞 |

### 4.6 Python矩形碰撞

```python
def rect_collision(x1, y1, w1, h1, x2, y2, w2, h2):
    """检测两矩形是否碰撞（AABB）"""
    x_overlap = x1 < x2 + w2 and x1 + w1 > x2
    y_overlap = y1 < y2 + h2 and y1 + h1 > y2
    return x_overlap and y_overlap

# 示例
hit = rect_collision(0, 0, 50, 50, 40, 40, 50, 50)  # True（有重叠）
```

### 4.7 Scratch碰撞检测

```scratch
// 使用内置碰撞检测
如果 <碰到 [敌人]> 那么
    // 碰撞处理
```

### 4.8 教学话术

> "圆形碰撞很简单：两个圆心的距离小于两个半径加起来，就是碰上了。矩形碰撞要看两个方向：横向有没有重叠，纵向有没有重叠，两个都重叠才算碰上。"

---

## 五、反弹与摩擦

### 5.1 反弹公式

```
碰到水平边界：vx = -vx
碰到垂直边界：vy = -vy
```

### 5.2 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| CODE1-4-04 | 躲避星星 | 边界反弹 |
| PYAI 2-2-7 | 积小致巨1 | 粒子反弹 |

### 5.3 Python反弹

```python
def bounce(x, y, vx, vy, width, height, radius):
    """边界反弹"""
    # 左右边界
    if x - radius < 0 or x + radius > width:
        vx = -vx
    # 上下边界
    if y - radius < 0 or y + radius > height:
        vy = -vy
    return vx, vy
```

### 5.4 摩擦力

```python
# 简单摩擦：每帧速度衰减
friction = 0.98
vx *= friction
vy *= friction
```

### 5.5 Scratch反弹

```scratch
// 碰到边缘反弹
碰到边缘就反弹

// 或手动实现
如果 <(x 座标) > (230)> 那么
    将 [X速度] 设为 ((X速度) * (-1))
```

---

## 六、数值映射

### 6.1 映射公式

```
输出 = (输入 - 输入最小) × (输出最大 - 输出最小) / (输入最大 - 输入最小) + 输出最小
```

### 6.2 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| CODE2-1-10 | 公路大冒险 | 电位器值映射 |
| MP1-L8 | 舵机与映射 | 旋钮控制舵机 |

### 6.3 Python映射函数

```python
def map_value(x, in_min, in_max, out_min, out_max):
    """将值从一个范围映射到另一个范围"""
    return (x - in_min) * (out_max - out_min) // (in_max - in_min) + out_min

# 示例：将旋钮值(0-4095)映射到舵机角度(0-180)
knob = 2048
angle = map_value(knob, 0, 4095, 0, 180)  # 90
```

### 6.4 教学话术

> "映射就像翻译。旋钮的值是0到4095，舵机的角度是0到180。我们要把旋钮的'语言'翻译成舵机的'语言'。"

---

## 七、教学建议

### 7.1 认知进阶路线

```
CODE1-4-04          CODE3-2-04          PYAI 1-2-1          PYAI 2-2-10
边界反弹     →      抛物线运动   →      碰撞检测     →      物理引擎
   ↓                   ↓                   ↓                   ↓
 速度反转            速度分解            距离公式            完整仿真
```

### 7.2 常见教学难点

| 难点 | 解决方案 |
|------|---------|
| 速度分解理解困难 | 用"斜坡上的小球"实物演示 |
| 碰撞检测公式复杂 | 先用Scratch内置碰撞，再讲原理 |
| 物理更新顺序 | 强调"先更新速度，再更新位置" |

---

**维护者**：知识库管理员
**关联文件**：[数学概念总表.md](数学概念总表.md)、[角度与三角函数.md](角度与三角函数.md)
