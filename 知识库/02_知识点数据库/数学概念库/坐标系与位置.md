# 坐标系与位置

> **用途**：坐标系统在各课程中的应用详解
> **更新日期**：2026-02-10
> **数据来源**：萃取报告/CODE/、萃取报告/PythonAI/

---

## 一、Scratch坐标系

### 1.1 基本概念

```
        y轴 (180)
         ↑
         |
(-240,0) |----+---→ x轴 (240,0)
         |  (0,0)
         |
         ↓
       (-180)
```

**特点**：
- 舞台大小：480 × 360 像素
- 原点(0,0)在舞台**中心**
- x范围：-240 到 240
- y范围：-180 到 180
- 与数学坐标系**一致**（y向上为正）

### 1.2 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| CODE1-3-06 | 坐标系统 | 首次认识x轴、y轴 |
| CODE1-4-01 | 捉人游戏 | 平面直角坐标系应用 |
| CODE1-4-02 | 斯斯接苹果 | 随机位置生成 |
| CODE2-3-01 | 猜数游戏 | 坐标比较 |
| CODE3-2-07 | 植物大战僵尸 | 网格坐标系统 |

### 1.3 常用积木

```scratch
// 移动到指定位置
移到 x: (100) y: (50)

// 滑行到指定位置
在 (1) 秒内滑行到 x: (100) y: (50)

// 获取当前位置
(x 座标)
(y 座标)

// 相对移动
将 x 改变 (10)
将 y 改变 (10)

// 设置位置
将 x 设为 (100)
将 y 设为 (50)
```

### 1.4 教学话术

> "小朋友们，Scratch的舞台就像一张方格纸。中间的点叫做原点，坐标是(0,0)。往右走x变大，往左走x变小；往上走y变大，往下走y变小。"

### 1.5 常见错误

| 错误 | 原因 | 正确做法 |
|------|------|---------|
| 角色跑出舞台 | x或y超出范围 | 添加边界检测 |
| 位置不准确 | 混淆"移到"和"改变" | "移到"是绝对位置，"改变"是相对移动 |

---

## 二、Python/Pygame坐标系

### 2.1 基本概念

```
(0,0)----→ x轴 (width,0)
  |
  |
  ↓
y轴
(0,height)
```

**特点**：
- 原点(0,0)在**左上角**
- x向右增大
- y向**下**增大（与数学坐标系相反！）
- 窗口大小可自定义（常用800×600）

### 2.2 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| PYAI 2-2-1 | 脚踏实地 | pygame窗口坐标 |
| PYAI 2-2-7 | 积小致巨1 | 粒子位置计算 |
| PYAI 2-2-10 | 举重若轻2 | 物理坐标转换 |

### 2.3 核心代码

```python
import pygame

# 初始化
pygame.init()
screen = pygame.display.set_mode((800, 600))

# 绘制在指定位置
x, y = 100, 200
pygame.draw.circle(screen, (255, 0, 0), (x, y), 20)

# 获取鼠标位置
mouse_x, mouse_y = pygame.mouse.get_pos()
```

### 2.4 坐标转换

```python
# 数学坐标 → Pygame坐标
def math_to_pygame(x, y, height):
    return x, height - y

# Pygame坐标 → 数学坐标
def pygame_to_math(x, y, height):
    return x, height - y
```

### 2.5 教学话术

> "Python的坐标系和Scratch不一样哦！原点在左上角，y轴是向下的。这是因为计算机屏幕是从上往下、从左往右扫描的。"

### 2.6 常见错误

| 错误 | 原因 | 正确做法 |
|------|------|---------|
| 物体位置颠倒 | y轴方向混淆 | 记住：y向下增大 |
| 物体跑出屏幕 | 未检查边界 | 添加边界检测代码 |

---

## 三、网格坐标系统

### 3.1 基本概念

将连续坐标离散化为网格单元，常用于塔防、棋盘类游戏。

```
┌───┬───┬───┬───┐
│0,0│1,0│2,0│3,0│
├───┼───┼───┼───┤
│0,1│1,1│2,1│3,1│
├───┼───┼───┼───┤
│0,2│1,2│2,2│3,2│
└───┴───┴───┴───┘
```

### 3.2 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| CODE3-2-07 | 植物大战僵尸 | 植物种植网格 |
| PYAI 1-3-6 | 落子无悔 | 棋盘坐标 |
| PYAI 1-3-7 | 三人成虎 | 二维数组索引 |

### 3.3 网格对齐算法

```python
# 将像素坐标对齐到网格
grid_size = 80

def snap_to_grid(x, y):
    grid_x = (x // grid_size) * grid_size
    grid_y = (y // grid_size) * grid_size
    return grid_x, grid_y

# 示例
mouse_x, mouse_y = 125, 230
grid_x, grid_y = snap_to_grid(mouse_x, mouse_y)
# 结果: (80, 160)
```

### 3.4 网格索引转换

```python
# 像素坐标 → 网格索引
def pixel_to_grid(x, y, grid_size):
    col = x // grid_size
    row = y // grid_size
    return row, col

# 网格索引 → 像素坐标（左上角）
def grid_to_pixel(row, col, grid_size):
    x = col * grid_size
    y = row * grid_size
    return x, y

# 网格索引 → 像素坐标（中心点）
def grid_to_center(row, col, grid_size):
    x = col * grid_size + grid_size // 2
    y = row * grid_size + grid_size // 2
    return x, y
```

### 3.5 Scratch网格实现

```scratch
// 网格对齐
将 [网格X] 设为 ((取整 ((鼠标的 x 座标) / (80))) * (80))
将 [网格Y] 设为 ((取整 ((鼠标的 y 座标) / (80))) * (80))
移到 x: (网格X) y: (网格Y)
```

---

## 四、相对坐标与卷轴

### 4.1 基本概念

当游戏世界大于屏幕时，使用相对坐标实现卷轴效果。

```
┌─────────────────────────────────────┐
│           游戏世界（大）              │
│    ┌───────────┐                    │
│    │  屏幕视口  │                    │
│    │  （小）    │                    │
│    └───────────┘                    │
└─────────────────────────────────────┘
```

### 4.2 跨课程出现

| 课程编号 | 课程名称 | 具体内容 |
|----------|---------|---------|
| CODE3-2-11 | 勇闯黑白岛 | 卷轴地图 |
| PYAI 2-2-10 | 举重若轻2 | 背景滚动 |

### 4.3 核心代码

```python
# 世界坐标 vs 屏幕坐标
class Camera:
    def __init__(self):
        self.x = 0
        self.y = 0

    def world_to_screen(self, world_x, world_y):
        """世界坐标转屏幕坐标"""
        screen_x = world_x - self.x
        screen_y = world_y - self.y
        return screen_x, screen_y

    def follow(self, target_x, target_y, screen_width, screen_height):
        """摄像机跟随目标"""
        self.x = target_x - screen_width // 2
        self.y = target_y - screen_height // 2
```

### 4.4 Scratch卷轴实现

```scratch
// 背景滚动
当绿旗被点击
重复执行
    将 x 改变 (-5)
    如果 <(x 座标) < (-480)> 那么
        将 x 设为 (480)
```

---

## 五、教学建议

### 5.1 认知进阶路线

```
CODE1-3-06          CODE1-4-01          CODE3-2-07          CODE3-2-11
坐标认识     →      坐标应用     →      网格坐标     →      卷轴坐标
   ↓                   ↓                   ↓                   ↓
 x/y轴              移动定位            离散化              相对坐标
```

### 5.2 常见教学难点

| 难点 | 解决方案 |
|------|---------|
| y轴方向混淆 | 用"电梯"类比：Scratch电梯往上走楼层变大，Pygame电梯往下走楼层变大 |
| 网格对齐理解困难 | 用"棋盘"类比：棋子只能放在格子里，不能放在线上 |
| 相对坐标抽象 | 用"火车窗外风景"类比：人不动，风景在动 |

---

**维护者**：知识库管理员
**关联文件**：[数学概念总表.md](数学概念总表.md)
