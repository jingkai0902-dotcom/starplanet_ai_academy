# 常见故障排查

> **用途**：跨课程硬件故障排查指南
> **更新日期**：2026-02-10
> **数据来源**：萃取报告/PythonAI/、萃取报告/STEM/
> **整合原则**：基于现有萃取报告，不压缩删减

---

## 一、ESP32开发板问题

### 1.1 无法连接/识别

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 电脑无法识别ESP32 | USB线只能充电 | 更换支持数据传输的USB线 |
| 串口被占用 | 其他程序占用 | 关闭其他串口软件，重启IDE |
| 驱动未安装 | 缺少CH340/CP2102驱动 | 安装对应USB转串口驱动 |
| 开发板损坏 | 短路或过压 | 更换开发板 |

### 1.2 代码上传失败

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 上传超时 | 未进入下载模式 | 按住BOOT键再点上传 |
| 端口错误 | 选错COM口 | 在设备管理器确认正确端口 |
| 权限问题 | 端口被占用 | 关闭其他程序，重启电脑 |

### 1.3 程序运行异常

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 程序不运行 | boot.py有错误 | 删除boot.py或修复错误 |
| 反复重启 | 代码死循环无延时 | 添加time.sleep() |
| 内存不足 | 程序太大 | 优化代码，减少变量 |

---

## 二、LED相关问题

### 2.1 LED不亮

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 完全不亮 | 引脚配置错误 | 检查Pin号和OUT模式 |
| 完全不亮 | 接线错误 | 检查VCC/GND/信号线 |
| 完全不亮 | LED损坏 | 更换LED |
| 亮度很暗 | 电压不足 | 检查电源电压 |

### 2.2 NeoPixel灯带问题

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 灯带不亮 | 未调用write() | 每次修改后调用strip.write() |
| 灯带不亮 | 未共地 | 连接ESP32和外部电源的GND |
| 灯带不亮 | 电源不足 | 使用外部5V电源 |
| 颜色错乱 | 灯珠数量设置错误 | 检查num参数 |
| 部分灯不亮 | 灯珠损坏 | 更换灯带 |

**代码检查**
```python
# ✅ 正确
strip.fill((255, 0, 0))
strip.write()  # 必须调用！

# ❌ 错误 - 忘记write()
strip.fill((255, 0, 0))
# 灯带不会更新
```

---

## 三、传感器问题

### 3.1 DHT11温湿度传感器

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 读数为None | 未调用measure() | 先调用dht.measure() |
| 读数不更新 | 读取间隔太短 | 两次读取间隔≥1秒 |
| 数据异常 | 接线错误 | 检查DATA引脚连接 |

**代码检查**
```python
# ✅ 正确
dht.measure()  # 必须先调用！
temp = dht.temperature
time.sleep(1)  # 等待1秒再读取

# ❌ 错误 - 忘记measure()
temp = dht.temperature  # 数据不会更新
```

### 3.2 HC-SR04超声波传感器

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 读数为0 | 电压不足 | 确保使用5V供电 |
| 读数不稳定 | 测量角度问题 | 传感器正对目标物体 |
| 读数异常 | Trig/Echo接反 | 检查引脚连接 |
| 超出范围 | 距离<2cm或>400cm | 调整测量距离 |

### 3.3 MQ-2B气体传感器

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 读数不准 | 未预热 | 通电预热1-2分钟 |
| 读数为0 | 电压不足 | 确保使用5V供电 |
| 读数一直很高 | 环境有气体 | 通风后再测试 |

### 3.4 土壤湿度传感器

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 读数不稳定 | 探针未完全插入 | 探针要完全插入土壤 |
| 读数异常 | 探针腐蚀 | 清洁或更换��针 |
| 读数一直很高 | 土壤太干 | 正常现象，需要浇水 |

### 3.5 光线传感器

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 读数不变 | 传感器被遮挡 | 检查传感器位置 |
| 读数异常 | 直射光干扰 | 避免灯光直射传感器 |

---

## 四、执行器问题

### 4.1 舵机问题

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 舵机不转 | 电压不足 | 确保使用5V供电 |
| 舵机抖动 | 角度超出范围 | 限制在0-180度 |
| 舵机卡死 | 齿轮损坏(扫齿) | 更换舵机 |
| 角度不准 | 校准问题 | 重新校准0度位置 |

**⚠️ 禁忌提醒**
- 绝对不要手动强行扭动舵机！
- 会导致内部齿轮损坏（扫齿）

### 4.2 电机/水泵问题

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 电机不转 | 直接接ESP32 | 必须通过继电器或驱动板 |
| 电机转速慢 | 电压不足 | 使用外部电源 |
| 水泵不工作 | 继电器未吸合 | 检查继电器控制信号 |
| 水泵空转 | 水管无水 | 确保水管有水 |

### 4.3 蜂鸣器问题

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 蜂鸣器不响 | 接线错误 | 检查VCC/GND/信号线 |
| 声音很小 | 电压不足 | 检查电源电压 |
| 无法变调 | 使用了有源蜂鸣器 | 有源蜂鸣器只能发固定音调 |

---

## 五、通信问题

### 5.1 串口通信问题

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 无数据 | TX/RX接反 | 交换TX和RX连接 |
| 乱码 | 波特率不匹配 | 两端使用相同波特率 |
| 数据丢失 | 未共地 | 连接两设备的GND |

### 5.2 I2C通信问题

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 设备无响应 | 地址错误 | 扫描I2C地址 |
| 设备无响应 | SCL/SDA接反 | 检查时钟线和数据线 |
| 通信不稳定 | 线路太长 | 缩短连接线长度 |

**I2C地址扫描代码**
```python
from machine import I2C, Pin
i2c = I2C(0, scl=Pin(22), sda=Pin(21))
devices = i2c.scan()
print(f"发现设备: {[hex(d) for d in devices]}")
```

---

## 六、摄像头问题

### 6.1 OpenCV摄像头问题

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 无法打开摄像头 | 摄像头被占用 | 关闭其他使用摄像头的程序 |
| 无法打开摄像头 | 设备号错误 | 尝试cv2.VideoCapture(0)或(1) |
| 画面卡顿 | 分辨率太高 | 降低分辨率 |
| 程序退出后摄像头仍占用 | 未释放资源 | 确保调用cap.release() |

**代码检查**
```python
# ✅ 正确 - 使用try-finally确保释放
cap = cv2.VideoCapture(0)
try:
    while True:
        ret, frame = cap.read()
        if not ret:
            break
        # 处理帧...
finally:
    cap.release()  # 必须释放！
    cv2.destroyAllWindows()

# ❌ 错误 - 忘记释放
cap = cv2.VideoCapture(0)
# 程序结束后摄像头仍被占用
```

---

## 七、电源问题

### 7.1 供电不足

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 设备工作不稳定 | USB供电不足 | 使用外部电源 |
| 多设备同时工作异常 | 电流超限 | 分开供电 |
| 开发板反复重启 | 电压波动 | 使用稳压电源 |

### 7.2 电压不匹配

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| 设备烧毁 | 5V接到3.3V设备 | 确认设备电压需求 |
| 设备不工作 | 3.3V接到5V设备 | 使用正确电压供电 |

---

## 八、软件问题

### 8.1 库导入错误

| 错误信息 | 原因 | 解决方法 |
|---------|------|---------|
| ModuleNotFoundError | 库未安装 | pip install 库名 |
| ImportError | 导入路径错误 | 检查from/import语句 |
| AttributeError | 类/方法名错误 | 检查API文档 |

### 8.2 常见代码错误

| 错误 | 原因 | 解决方法 |
|------|------|---------|
| Pin号错误 | 使用了不存在的引脚 | 查阅ESP32引脚图 |
| ADC读数为0 | 未设置量程 | 添加atten(ADC.ATTN_11DB) |
| PWM不工作 | 频率设置错误 | 检查freq参数 |

---

## 九、快速排查流程

### 9.1 设备不工作排查流程

```
1. 检查电源
   ├─ VCC/GND是否正确连接？
   ├─ 电压是否匹配（3.3V/5V）？
   └─ 电源是否稳定？

2. 检查接线
   ├─ 信号线是否连接正确引脚？
   ├─ 是否有松动？
   └─ 是否有短路？

3. 检查代码
   ├─ 引脚号是否正确？
   ├─ 是否调用了必要的方法？
   └─ 是否有语法错误？

4. 检查硬件
   ├─ 设备是否损坏？
   └─ 更换设备测试
```

### 9.2 通信问题排查流程

```
1. 检查物理连接
   ├─ 线路是否连接？
   ├─ TX/RX是否交叉？
   └─ 是否共地？

2. 检查参数设置
   ├─ 波特率是否一致？
   ├─ I2C地址是否正确？
   └─ 引脚配置是否正确？

3. 使用测试代码
   ├─ 发送简单数据测试
   └─ 扫描I2C设备
```

---

## 十、预防措施

### 10.1 接线前检查

| 检查项 | 说明 |
|--------|------|
| ☐ 断电操作 | 接线前必须断开USB |
| ☐ 电压确认 | 确认设备电压需求 |
| ☐ 引脚确认 | 查阅引脚图确认连接 |
| ☐ 绝缘表面 | 开发板放在绝缘表面 |

### 10.2 代码编写规范

| 规范 | 说明 |
|------|------|
| 资源释放 | 程序结束前释放摄像头等资源 |
| 延时添加 | 循环中添加适当延时 |
| 错误处理 | 添加try-except处理异常 |
| 范围检查 | 检查数值是否在有效范围 |

---

**维护者**：知识库管理员
**数据来源**：萃取报告/PythonAI/、萃取报告/STEM/
**整合原则**：基于现有萃取报告，不压缩删减
