{
  "title": "[PYAI-1-4-09] 音强流水灯",
  "source": "C:\\Users\\Frank.J\\starplanet_ai_academy\\知识库\\萃取报告\\PythonAI\\L1\\M4_智能硬件\\PYAI-1-4-09_音强流水灯.md",
  "sections": [
    {
      "title": "课程基本信息",
      "content": "| 项目 | 内容 |\n|------|------|\n| **课程编号** | PYAI-1-4-09 |\n| **课程名称** | 音强流水灯 |\n| **认知负荷** | 中-高 |\n| **核心技能** | NeoPixel灯带、声音传感器、流水灯算法 |\n| **课时** | 90分钟 |\n\n---"
    },
    {
      "title": "详细教学流程",
      "content": "### 步骤1：课程导入（5分钟）\n\n`#低负荷-热身` `#IFC-预防`\n\n**教师话术**\n> \"同学们见过KTV里跟着音乐闪烁的灯光吗？今天我们来做一个**音乐律动灯**——灯光会随着声音的强弱变化！\"\n\n---\n\n### 步骤2：知识讲解（15分钟）\n\n`#中负荷-操练` `#IFC-即时`\n\n**教师话术**\n> \"**NeoPixel灯带**：可以单独控制每颗LED的颜色\n>\n> ```python\n> import neopixel\n> from machine import Pin\n>\n> NUM_LEDS = 30  # 灯珠数量\n> np = neopixel.NeoPixel(Pin(4), NUM_LEDS)\n>\n> # 设置第一颗灯为红色\n> np[0] = (255, 0, 0)  # (R, G, B)\n> np.write()  # 更新显示\n> ```\n>\n> **声音传感器**：检测环境音量\n> ```python\n> from machine import Pin, ADC\n>\n> mic = ADC(Pin(34))\n> mic.atten(ADC.ATTN_11DB)  # 设置量程\n>\n> sound_level = mic.read()  # 读取音量值（0-4095）\n> ```\n>\n> **流水灯算法**：让颜色像水一样流动\n> ```python\n> # 核心思想：列表元素向右偏移\n> colors = [(255,0,0), (0,255,0), (0,0,255), ...]\n>\n> # 每次循环，最后一个颜色移到最前面\n> last_color = colors.pop()  # 取出最后一个\n> colors.insert(0, last_color)  # 插入到最前面\n> ```\"\n\n**核心代码模式**\n\n```python\nimport neopixel\nimport time\nfrom machine import Pin, ADC\n\n# 初始化\nNUM_LEDS = 30\nnp = neopixel.NeoPixel(Pin(4), NUM_LEDS)\nmic = ADC(Pin(34))\nmic.atten(ADC.ATTN_11DB)\n\n# 初始化颜色列表（渐变色）\ncolors = []\nfor i in range(NUM_LEDS):\n    # 生成彩虹渐变\n    hue = int(i * 255 / NUM_LEDS)\n    colors.append((hue, 255 - hue, 128))\n\nwhile True:\n    # 读取音量\n    sound = mic.read()\n\n    # 根据音量调整亮度\n    brightness = min(255, sound // 16)\n\n    # 应用颜色到灯带\n    for i in range(NUM_LEDS):\n        r = colors[i][0] * brightness // 255\n        g = colors[i][1] * brightness // 255\n        b = colors[i][2] * brightness // 255\n        np[i] = (r, g, b)\n    np.write()\n\n    # 流水效果：颜色向右移动\n    last = colors.pop()\n    colors.insert(0, last)\n\n    time.sleep_ms(50)\n```\n\n**变体示例**\n\n| 学生情况 | 调整方案 | 说明 |\n|----------|----------|------|\n| 灯带不亮 | 检查供电 | NeoPixel需要5V供电，电流较大 |\n| 音量检测不灵敏 | 调整阈值 | 根据环境噪音调整基准值 |\n| 想要不同效果 | 修改算法 | 可以做呼吸灯、闪烁、追逐等效果 |\n\n---\n\n### 步骤3：硬件搭建（20分钟）\n\n`#高负荷-产出` `#IFC-即时`\n\n**教师话术**\n> \"今天的硬件：\n>\n> **NeoPixel灯带接线**：\n> ```\n> VCC → 5V（外部电源，不要用ESP32的5V）\n> GND → GND（与ESP32共地）\n> DIN → P4（数据输入）\n> ```\n>\n> **声音传感器接线**：\n> ```\n> VCC → 3.3V\n> GND → GND\n> AO  → P34（模拟输出）\n> ```\n>\n> **重要**：灯带耗电大，30颗灯全亮可能需要1.8A电流，必须用外部电源！\"\n\n**禁忌提醒**\n\n❌ **灯带直接接ESP32的5V**——电流不够，可能烧毁USB口\n❌ **忘记共地**——灯带和ESP32的GND必须连接\n❌ **数据线接错**——DIN是输入，DOUT是输出（级联用）\n\n---\n\n### 步骤4：编程调试（30分钟）\n\n`#高负荷-产出` `#IFC-即时`\n\n**教师话术**\n> \"调试步骤：\n>\n> 1. **先测试灯带**：\n>    ```python\n>    # 让所有灯亮红色\n>    for i in range(NUM_LEDS):\n>        np[i] = (255, 0, 0)\n>    np.write()\n>    ```\n>\n> 2. **再测试声音传感器**：\n>    ```python\n>    while True:\n>        print(mic.read())\n>        time.sleep_ms(100)\n>    ```\n>    对着传感器说话，观察数值变化\n>\n> 3. **最后联调**：\n>    - 安静时灯光暗\n>    - 声音大时灯光亮\n>    - 颜色在流动\"\n\n**变体示例**\n\n| 学生情况 | 调整方案 | 说明 |\n|----------|----------|------|\n| 灯光闪烁不稳定 | 添加平滑处理 | 用移动平均值平滑音量数据 |\n| 想做音乐节奏灯 | 检测节拍 | 检测音量的突变作为节拍 |\n| 想控制更多灯 | 级联灯带 | 多条灯带可以串联 |\n\n---\n\n### 步骤5：成果展示（10分钟）\n\n`#低负荷-热身` `#IFC-复盘`\n\n**教师话术**\n> \"谁的音乐律动灯做好了？放一首歌试试效果！\n>\n> 思考：如何让灯光效果更炫酷？\n> - 不同音量对应不同颜色\n> - 低音和高音分开显示\n> - 添加闪烁效果\"\n\n---"
    },
    {
      "title": "核心知识点",
      "content": "- NeoPixel灯带：可单独控制每颗LED颜色\n- 声音传感器：ADC读取模拟音量值\n- 流水灯算法：列表元素循环移位\n- 亮度映射：音量值映射到亮度\n\n---"
    },
    {
      "title": "底层逻辑",
      "content": "- **数据驱动显示**：传感器数据 → 视觉效果\n- **列表操作**：pop()和insert()实现循环移位\n\n---\n\n`#执行层` `#测评项`\n[UID: PYAI-14-09-001]\n\n---\n\n[上一课](PYAI-1-4-08_智能门禁3.md) | [返回模块](_模块概览.md) | [下一课](PYAI-1-4-10_智能花房1.md)"
    }
  ],
  "full_content": "# [PYAI-1-4-09] 音强流水灯\n\n> **模块**：L1-M4 智能硬件\n> **认知负荷**：中-高\n> **核心技能**：NeoPixel灯带、声音传感器、流水灯算法\n> **UID**：PYAI-14-09-001\n\n---\n\n## 课程基本信息\n\n| 项目 | 内容 |\n|------|------|\n| **课程编号** | PYAI-1-4-09 |\n| **课程名称** | 音强流水灯 |\n| **认知负荷** | 中-高 |\n| **核心技能** | NeoPixel灯带、声音传感器、流水灯算法 |\n| **课时** | 90分钟 |\n\n---\n\n## 详细教学流程\n\n### 步骤1：课程导入（5分钟）\n\n`#低负荷-热身` `#IFC-预防`\n\n**教师话术**\n> \"同学们见过KTV里跟着音乐闪烁的灯光吗？今天我们来做一个**音乐律动灯**——灯光会随着声音的强弱变化！\"\n\n---\n\n### 步骤2：知识讲解（15分钟）\n\n`#中负荷-操练` `#IFC-即时`\n\n**教师话术**\n> \"**NeoPixel灯带**：可以单独控制每颗LED的颜色\n>\n> ```python\n> import neopixel\n> from machine import Pin\n>\n> NUM_LEDS = 30  # 灯珠数量\n> np = neopixel.NeoPixel(Pin(4), NUM_LEDS)\n>\n> # 设置第一颗灯为红色\n> np[0] = (255, 0, 0)  # (R, G, B)\n> np.write()  # 更新显示\n> ```\n>\n> **声音传感器**：检测环境音量\n> ```python\n> from machine import Pin, ADC\n>\n> mic = ADC(Pin(34))\n> mic.atten(ADC.ATTN_11DB)  # 设置量程\n>\n> sound_level = mic.read()  # 读取音量值（0-4095）\n> ```\n>\n> **流水灯算法**：让颜色像水一样流动\n> ```python\n> # 核心思想：列表元素向右偏移\n> colors = [(255,0,0), (0,255,0), (0,0,255), ...]\n>\n> # 每次循环，最后一个颜色移到最前面\n> last_color = colors.pop()  # 取出最后一个\n> colors.insert(0, last_color)  # 插入到最前面\n> ```\"\n\n**核心代码模式**\n\n```python\nimport neopixel\nimport time\nfrom machine import Pin, ADC\n\n# 初始化\nNUM_LEDS = 30\nnp = neopixel.NeoPixel(Pin(4), NUM_LEDS)\nmic = ADC(Pin(34))\nmic.atten(ADC.ATTN_11DB)\n\n# 初始化颜色列表（渐变色）\ncolors = []\nfor i in range(NUM_LEDS):\n    # 生成彩虹渐变\n    hue = int(i * 255 / NUM_LEDS)\n    colors.append((hue, 255 - hue, 128))\n\nwhile True:\n    # 读取音量\n    sound = mic.read()\n\n    # 根据音量调整亮度\n    brightness = min(255, sound // 16)\n\n    # 应用颜色到灯带\n    for i in range(NUM_LEDS):\n        r = colors[i][0] * brightness // 255\n        g = colors[i][1] * brightness // 255\n        b = colors[i][2] * brightness // 255\n        np[i] = (r, g, b)\n    np.write()\n\n    # 流水效果：颜色向右移动\n    last = colors.pop()\n    colors.insert(0, last)\n\n    time.sleep_ms(50)\n```\n\n**变体示例**\n\n| 学生情况 | 调整方案 | 说明 |\n|----------|----------|------|\n| 灯带不亮 | 检查供电 | NeoPixel需要5V供电，电流较大 |\n| 音量检测不灵敏 | 调整阈值 | 根据环境噪音调整基准值 |\n| 想要不同效果 | 修改算法 | 可以做呼吸灯、闪烁、追逐等效果 |\n\n---\n\n### 步骤3：硬件搭建（20分钟）\n\n`#高负荷-产出` `#IFC-即时`\n\n**教师话术**\n> \"今天的硬件：\n>\n> **NeoPixel灯带接线**：\n> ```\n> VCC → 5V（外部电源，不要用ESP32的5V）\n> GND → GND（与ESP32共地）\n> DIN → P4（数据输入）\n> ```\n>\n> **声音传感器接线**：\n> ```\n> VCC → 3.3V\n> GND → GND\n> AO  → P34（模拟输出）\n> ```\n>\n> **重要**：灯带耗电大，30颗灯全亮可能需要1.8A电流，必须用外部电源！\"\n\n**禁忌提醒**\n\n❌ **灯带直接接ESP32的5V**——电流不够，可能烧毁USB口\n❌ **忘记共地**——灯带和ESP32的GND必须连接\n❌ **数据线接错**——DIN是输入，DOUT是输出（级联用）\n\n---\n\n### 步骤4：编程调试（30分钟）\n\n`#高负荷-产出` `#IFC-即时`\n\n**教师话术**\n> \"调试步骤：\n>\n> 1. **先测试灯带**：\n>    ```python\n>    # 让所有灯亮红色\n>    for i in range(NUM_LEDS):\n>        np[i] = (255, 0, 0)\n>    np.write()\n>    ```\n>\n> 2. **再测试声音传感器**：\n>    ```python\n>    while True:\n>        print(mic.read())\n>        time.sleep_ms(100)\n>    ```\n>    对着传感器说话，观察数值变化\n>\n> 3. **最后联调**：\n>    - 安静时灯光暗\n>    - 声音大时灯光亮\n>    - 颜色在流动\"\n\n**变体示例**\n\n| 学生情况 | 调整方案 | 说明 |\n|----------|----------|------|\n| 灯光闪烁不稳定 | 添加平滑处理 | 用移动平均值平滑音量数据 |\n| 想做音乐节奏灯 | 检测节拍 | 检测音量的突变作为节拍 |\n| 想控制更多灯 | 级联灯带 | 多条灯带可以串联 |\n\n---\n\n### 步骤5：成果展示（10分钟）\n\n`#低负荷-热身` `#IFC-复盘`\n\n**教师话术**\n> \"谁的音乐律动灯做好了？放一首歌试试效果！\n>\n> 思考：如何让灯光效果更炫酷？\n> - 不同音量对应不同颜色\n> - 低音和高音分开显示\n> - 添加闪烁效果\"\n\n---\n\n## 核心知识点\n\n- NeoPixel灯带：可单独控制每颗LED颜色\n- 声音传感器：ADC读取模拟音量值\n- 流水灯算法：列表元素循环移位\n- 亮度映射：音量值映射到亮度\n\n---\n\n## 底层逻辑\n\n- **数据驱动显示**：传感器数据 → 视觉效果\n- **列表操作**：pop()和insert()实现循环移位\n\n---\n\n`#执行层` `#测评项`\n[UID: PYAI-14-09-001]\n\n---\n\n[上一课](PYAI-1-4-08_智能门禁3.md) | [返回模块](_模块概览.md) | [下一课](PYAI-1-4-10_智能花房1.md)\n"
}