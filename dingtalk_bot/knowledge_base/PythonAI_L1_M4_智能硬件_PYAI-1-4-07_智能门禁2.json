{
  "title": "[PYAI-1-4-07] 智能门禁(2) - 人脸比对算法",
  "source": "C:\\Users\\Frank.J\\starplanet_ai_academy\\知识库\\萃取报告\\PythonAI\\L1\\M4_智能硬件\\PYAI-1-4-07_智能门禁2.md",
  "sections": [
    {
      "title": "课程基本信息",
      "content": "| 项目 | 内容 |\n|------|------|\n| **课程编号** | PYAI-1-4-07 |\n| **课程名称** | 智能门禁(2) - 人脸比对算法 |\n| **认知负荷** | 高 |\n| **核心技能** | 灰度处理cvtColor、特征匹配matchTemplate |\n| **课时** | 90分钟 |\n| **系列** | 智能门禁三部曲（2/3） |\n\n---"
    },
    {
      "title": "详细教学流程",
      "content": "### 步骤1：课程回顾（5分钟）\n\n`#低负荷-热身` `#IFC-预防`\n\n**教师话术**\n> \"上节课我们学会了用摄像头拍照。今天我们要让电脑'认识'人脸——通过比对算法判断是不是同一个人！\"\n\n---\n\n### 步骤2：知识讲解（15分钟）\n\n`#中负荷-操练` `#IFC-即时`\n\n**教师话术**\n> \"人脸比对的步骤是：\n>\n> **1. 灰度处理**：把彩色图变成黑白图，减少计算量\n> ```python\n> import cv2\n>\n> # 读取彩色图像\n> color_img = cv2.imread('photo.jpg')\n>\n> # 转换为灰度图\n> gray = cv2.cvtColor(color_img, cv2.COLOR_BGR2GRAY)\n> ```\n>\n> **为什么要灰度？**\n> - 彩色图有3个通道（BGR），灰度图只有1个通道\n> - 计算量减少到1/3\n> - 人脸特征主要靠轮廓，不需要颜色信息\n>\n> **2. 特征匹配**：把当前人脸和保存的人脸对比\n> ```python\n> # 模板匹配\n> result = cv2.matchTemplate(gray, template, cv2.TM_CCOEFF_NORMED)\n>\n> # 获取最大相似度\n> min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(result)\n> similarity = max_val  # 相似度（0-1）\n> ```\n>\n> **相似度判断**：\n> - 0.8以上：很可能是同一个人\n> - 0.6-0.8：可能是同一个人\n> - 0.6以下：不是同一个人\"\n\n**核心代码模式**\n\n```python\nimport cv2\n\ndef compare_faces(img1_path, img2_path):\n    \"\"\"比较两张人脸图片的相似度\"\"\"\n    # 读取图片\n    img1 = cv2.imread(img1_path, cv2.IMREAD_GRAYSCALE)\n    img2 = cv2.imread(img2_path, cv2.IMREAD_GRAYSCALE)\n\n    # 调整大小（确保尺寸一致）\n    img1 = cv2.resize(img1, (100, 100))\n    img2 = cv2.resize(img2, (100, 100))\n\n    # 模板匹配\n    result = cv2.matchTemplate(img1, img2, cv2.TM_CCOEFF_NORMED)\n\n    # 获取相似度\n    similarity = result[0][0]\n\n    return similarity\n\n# 使用示例\nsim = compare_faces('face1.jpg', 'face2.jpg')\nprint(f'相似度: {sim:.2f}')\n\nif sim > 0.8:\n    print('匹配成功！是同一个人')\nelse:\n    print('匹配失败！不是同一个人')\n```\n\n**变体示例**\n\n| 学生情况 | 调整方案 | 说明 |\n|----------|----------|------|\n| 不理解灰度 | 用黑白照片类比 | \"灰度就像老照片，只有黑白\" |\n| 匹配不准 | 调整阈值 | \"相似度0.8以上才算匹配成功\" |\n| 想识别多人 | 引导使用列表 | 保存多个人脸模板 |\n\n---\n\n### 步骤3：实践准备（20分钟）\n\n`#高负荷-产出` `#IFC-即时`\n\n**教师话术**\n> \"现在我们来准备人脸模板：\n>\n> **步骤1**：拍摄自己的人脸照片\n> ```python\n> import cv2\n>\n> cap = cv2.VideoCapture(0)\n> ret, frame = cap.read()\n>\n> # 保存为模板\n> cv2.imwrite('my_face.jpg', frame)\n> cap.release()\n> ```\n>\n> **步骤2**：裁剪人脸区域（可选）\n> ```python\n> # 手动裁剪人脸区域\n> face_region = frame[100:300, 150:350]  # [y1:y2, x1:x2]\n> cv2.imwrite('my_face_crop.jpg', face_region)\n> ```\n>\n> **注意**：拍照时保持正面、光线充足、表情自然\"\n\n---\n\n### 步骤4：编程调试（30分钟）\n\n`#高负荷-产出` `#IFC-即时`\n\n**教师话术**\n> \"现在实现实时人脸比对：\n>\n> ```python\n> import cv2\n>\n> # 加载人脸模板\n> template = cv2.imread('my_face.jpg', cv2.IMREAD_GRAYSCALE)\n> template = cv2.resize(template, (100, 100))\n>\n> cap = cv2.VideoCapture(0)\n>\n> while True:\n>     ret, frame = cap.read()\n>     if not ret:\n>         break\n>\n>     # 转灰度\n>     gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)\n>     gray_resized = cv2.resize(gray, (100, 100))\n>\n>     # 计算相似度\n>     result = cv2.matchTemplate(gray_resized, template, cv2.TM_CCOEFF_NORMED)\n>     similarity = result[0][0]\n>\n>     # 显示结果\n>     if similarity > 0.6:\n>         text = f'Match! {similarity:.2f}'\n>         color = (0, 255, 0)  # 绿色\n>     else:\n>         text = f'No Match {similarity:.2f}'\n>         color = (0, 0, 255)  # 红色\n>\n>     cv2.putText(frame, text, (10, 30),\n>                 cv2.FONT_HERSHEY_SIMPLEX, 1, color, 2)\n>     cv2.imshow('Face Recognition', frame)\n>\n>     if cv2.waitKey(1) & 0xFF == ord('q'):\n>         break\n>\n> cap.release()\n> cv2.destroyAllWindows()\n> ```\"\n\n**变体示例**\n\n| 学生情况 | 调整方案 | 说明 |\n|----------|----------|------|\n| 相似度一直很低 | 重新拍模板 | 确保光线和角度一致 |\n| 想提高准确率 | 使用人脸检测 | 先检测人脸再比对 |\n| 想加声音提示 | 导入winsound | 匹配成功时播放声音 |\n\n---\n\n### 步骤5：成果展示（10分钟）\n\n`#低负荷-热身` `#IFC-复盘`\n\n**教师话术**\n> \"谁的人脸比对做好了？试试看能不能识别出自己！\n>\n> 下节课我们将把AI和硬件连接起来——刷脸开门！\"\n\n---"
    },
    {
      "title": "核心知识点",
      "content": "- 灰度处理：`cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)`\n- 模板匹配：`cv2.matchTemplate(img, template, method)`\n- 相似度获取：`cv2.minMaxLoc(result)` 返回最大值\n- 阈值判断：相似度 > 0.8 认为匹配成功\n\n---"
    },
    {
      "title": "底层逻辑",
      "content": "- **图像预处理**：灰度化减少计算量\n- **特征匹配**：计算两张图的相似程度\n- **阈值决策**：根据相似度做出判断\n\n---\n\n`#执行层` `#测评项`\n[UID: PYAI-14-07-001]\n\n---\n\n[上一课](PYAI-1-4-06_智能门禁1.md) | [返回模块](_模块概览.md) | [下一课](PYAI-1-4-08_智能门禁3.md)"
    }
  ],
  "full_content": "# [PYAI-1-4-07] 智能门禁(2) - 人脸比对算法\n\n> **模块**：L1-M4 智能硬件\n> **认知负荷**：高\n> **核心技能**：灰度处理cvtColor、特征匹配matchTemplate\n> **UID**：PYAI-14-07-001\n\n---\n\n## 课程基本信息\n\n| 项目 | 内容 |\n|------|------|\n| **课程编号** | PYAI-1-4-07 |\n| **课程名称** | 智能门禁(2) - 人脸比对算法 |\n| **认知负荷** | 高 |\n| **核心技能** | 灰度处理cvtColor、特征匹配matchTemplate |\n| **课时** | 90分钟 |\n| **系列** | 智能门禁三部曲（2/3） |\n\n---\n\n## 详细教学流程\n\n### 步骤1：课程回顾（5分钟）\n\n`#低负荷-热身` `#IFC-预防`\n\n**教师话术**\n> \"上节课我们学会了用摄像头拍照。今天我们要让电脑'认识'人脸——通过比对算法判断是不是同一个人！\"\n\n---\n\n### 步骤2：知识讲解（15分钟）\n\n`#中负荷-操练` `#IFC-即时`\n\n**教师话术**\n> \"人脸比对的步骤是：\n>\n> **1. 灰度处理**：把彩色图变成黑白图，减少计算量\n> ```python\n> import cv2\n>\n> # 读取彩色图像\n> color_img = cv2.imread('photo.jpg')\n>\n> # 转换为灰度图\n> gray = cv2.cvtColor(color_img, cv2.COLOR_BGR2GRAY)\n> ```\n>\n> **为什么要灰度？**\n> - 彩色图有3个通道（BGR），灰度图只有1个通道\n> - 计算量减少到1/3\n> - 人脸特征主要靠轮廓，不需要颜色信息\n>\n> **2. 特征匹配**：把当前人脸和保存的人脸对比\n> ```python\n> # 模板匹配\n> result = cv2.matchTemplate(gray, template, cv2.TM_CCOEFF_NORMED)\n>\n> # 获取最大相似度\n> min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(result)\n> similarity = max_val  # 相似度（0-1）\n> ```\n>\n> **相似度判断**：\n> - 0.8以上：很可能是同一个人\n> - 0.6-0.8：可能是同一个人\n> - 0.6以下：不是同一个人\"\n\n**核心代码模式**\n\n```python\nimport cv2\n\ndef compare_faces(img1_path, img2_path):\n    \"\"\"比较两张人脸图片的相似度\"\"\"\n    # 读取图片\n    img1 = cv2.imread(img1_path, cv2.IMREAD_GRAYSCALE)\n    img2 = cv2.imread(img2_path, cv2.IMREAD_GRAYSCALE)\n\n    # 调整大小（确保尺寸一致）\n    img1 = cv2.resize(img1, (100, 100))\n    img2 = cv2.resize(img2, (100, 100))\n\n    # 模板匹配\n    result = cv2.matchTemplate(img1, img2, cv2.TM_CCOEFF_NORMED)\n\n    # 获取相似度\n    similarity = result[0][0]\n\n    return similarity\n\n# 使用示例\nsim = compare_faces('face1.jpg', 'face2.jpg')\nprint(f'相似度: {sim:.2f}')\n\nif sim > 0.8:\n    print('匹配成功！是同一个人')\nelse:\n    print('匹配失败！不是同一个人')\n```\n\n**变体示例**\n\n| 学生情况 | 调整方案 | 说明 |\n|----------|----------|------|\n| 不理解灰度 | 用黑白照片类比 | \"灰度就像老照片，只有黑白\" |\n| 匹配不准 | 调整阈值 | \"相似度0.8以上才算匹配成功\" |\n| 想识别多人 | 引导使用列表 | 保存多个人脸模板 |\n\n---\n\n### 步骤3：实践准备（20分钟）\n\n`#高负荷-产出` `#IFC-即时`\n\n**教师话术**\n> \"现在我们来准备人脸模板：\n>\n> **步骤1**：拍摄自己的人脸照片\n> ```python\n> import cv2\n>\n> cap = cv2.VideoCapture(0)\n> ret, frame = cap.read()\n>\n> # 保存为模板\n> cv2.imwrite('my_face.jpg', frame)\n> cap.release()\n> ```\n>\n> **步骤2**：裁剪人脸区域（可选）\n> ```python\n> # 手动裁剪人脸区域\n> face_region = frame[100:300, 150:350]  # [y1:y2, x1:x2]\n> cv2.imwrite('my_face_crop.jpg', face_region)\n> ```\n>\n> **注意**：拍照时保持正面、光线充足、表情自然\"\n\n---\n\n### 步骤4：编程调试（30分钟）\n\n`#高负荷-产出` `#IFC-即时`\n\n**教师话术**\n> \"现在实现实时人脸比对：\n>\n> ```python\n> import cv2\n>\n> # 加载人脸模板\n> template = cv2.imread('my_face.jpg', cv2.IMREAD_GRAYSCALE)\n> template = cv2.resize(template, (100, 100))\n>\n> cap = cv2.VideoCapture(0)\n>\n> while True:\n>     ret, frame = cap.read()\n>     if not ret:\n>         break\n>\n>     # 转灰度\n>     gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)\n>     gray_resized = cv2.resize(gray, (100, 100))\n>\n>     # 计算相似度\n>     result = cv2.matchTemplate(gray_resized, template, cv2.TM_CCOEFF_NORMED)\n>     similarity = result[0][0]\n>\n>     # 显示结果\n>     if similarity > 0.6:\n>         text = f'Match! {similarity:.2f}'\n>         color = (0, 255, 0)  # 绿色\n>     else:\n>         text = f'No Match {similarity:.2f}'\n>         color = (0, 0, 255)  # 红色\n>\n>     cv2.putText(frame, text, (10, 30),\n>                 cv2.FONT_HERSHEY_SIMPLEX, 1, color, 2)\n>     cv2.imshow('Face Recognition', frame)\n>\n>     if cv2.waitKey(1) & 0xFF == ord('q'):\n>         break\n>\n> cap.release()\n> cv2.destroyAllWindows()\n> ```\"\n\n**变体示例**\n\n| 学生情况 | 调整方案 | 说明 |\n|----------|----------|------|\n| 相似度一直很低 | 重新拍模板 | 确保光线和角度一致 |\n| 想提高准确率 | 使用人脸检测 | 先检测人脸再比对 |\n| 想加声音提示 | 导入winsound | 匹配成功时播放声音 |\n\n---\n\n### 步骤5：成果展示（10分钟）\n\n`#低负荷-热身` `#IFC-复盘`\n\n**教师话术**\n> \"谁的人脸比对做好了？试试看能不能识别出自己！\n>\n> 下节课我们将把AI和硬件连接起来——刷脸开门！\"\n\n---\n\n## 核心知识点\n\n- 灰度处理：`cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)`\n- 模板匹配：`cv2.matchTemplate(img, template, method)`\n- 相似度获取：`cv2.minMaxLoc(result)` 返回最大值\n- 阈值判断：相似度 > 0.8 认为匹配成功\n\n---\n\n## 底层逻辑\n\n- **图像预处理**：灰度化减少计算量\n- **特征匹配**：计算两张图的相似程度\n- **阈值决策**：根据相似度做出判断\n\n---\n\n`#执行层` `#测评项`\n[UID: PYAI-14-07-001]\n\n---\n\n[上一课](PYAI-1-4-06_智能门禁1.md) | [返回模块](_模块概览.md) | [下一课](PYAI-1-4-08_智能门禁3.md)\n"
}