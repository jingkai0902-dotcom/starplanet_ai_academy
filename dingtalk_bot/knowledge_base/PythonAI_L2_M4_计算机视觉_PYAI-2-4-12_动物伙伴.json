{
  "title": "[PYAI-2-4-12] 动物伙伴",
  "source": "C:\\Users\\Frank.J\\starplanet_ai_academy\\知识库\\萃取报告\\PythonAI\\L2\\M4_计算机视觉\\PYAI-2-4-12_动物伙伴.md",
  "sections": [
    {
      "title": "课程基本信息",
      "content": "| 项目 | 内容 |\n|------|------|\n| **课程编号** | PYAI-2-4-12 |\n| **课程名称** | 动物伙伴 - 肩膀上的宠物 |\n| **认知负荷** | 高 |\n| **核心技能** | Pose模型、GIF处理、位置跟随 |\n| **项目内容** | 肩膀上的宠物 |\n\n---"
    },
    {
      "title": "详细教学流程",
      "content": "### 步骤1：知识讲解（20分钟）\n\n`#中负荷-操练` `#IFC-即时`\n\n**教师话术**\n> \"今天我们来做一个超酷的AR效果——**肩膀上的虚拟宠物**！\n>\n> 需要解决三个问题：\n> 1. **找到肩膀位置**：用MediaPipe Pose模型检测身体关键点\n> 2. **加载动画宠物**：处理GIF动图\n> 3. **让宠物跟随移动**：实时更新位置\n>\n> ```python\n> import mediapipe as mp\n>\n> # 初始化Pose模型\n> mp_pose = mp.solutions.pose\n> pose = mp_pose.Pose()\n>\n> # 处理图像获取关键点\n> results = pose.process(frame_rgb)\n>\n> # 获取左肩位置（索引11）和右肩位置（索引12）\n> if results.pose_landmarks:\n>     left_shoulder = results.pose_landmarks.landmark[11]\n>     right_shoulder = results.pose_landmarks.landmark[12]\n>     # 坐标是0-1的比例，需要乘以图像尺寸\n>     x = int(left_shoulder.x * width)\n>     y = int(left_shoulder.y * height)\n> ```\"\n\n**变体示例**\n\n| 学生情况 | 调整方案 | 说明 |\n|----------|----------|------|\n| 想放在头顶 | 改用头部关键点 | 索引0是鼻子，可以往上偏移 |\n| 宠物太大/太小 | 根据肩宽缩放 | 用两肩距离计算合适的宠物大小 |\n| 想用静态图片 | 简化为PNG | 不需要GIF处理，直接叠加 |\n\n---\n\n### 步骤2：代码实践（35分钟）\n\n`#高负荷-产出` `#IFC-即时`\n\n**教师话术**\n> \"现在我们来处理GIF动图。Python可以用PIL库读取GIF的每一帧：\n>\n> ```python\n> from PIL import Image\n> import numpy as np\n>\n> # 加载GIF\n> gif = Image.open('pet.gif')\n> frames = []\n>\n> # 提取所有帧\n> try:\n>     while True:\n>         # 转换为RGBA（带透明通道）\n>         frame = gif.convert('RGBA')\n>         frames.append(np.array(frame))\n>         gif.seek(gif.tell() + 1)  # 下一帧\n> except EOFError:\n>     pass  # 读完了\n>\n> # 循环播放\n> frame_index = 0\n> pet_frame = frames[frame_index % len(frames)]\n> frame_index += 1\n> ```\"\n\n---\n\n### 步骤3：叠加宠物（15分钟）\n\n`#高负荷-产出` `#IFC-即时`\n\n**教师话术**\n> \"最后把宠物叠加到肩膀位置。注意处理透明通道：\n>\n> ```python\n> def overlay_image(background, overlay, x, y):\n>     '''将带透明通道的图片叠加到背景上'''\n>     h, w = overlay.shape[:2]\n>\n>     # 确保不超出边界\n>     if x < 0 or y < 0 or x + w > background.shape[1] or y + h > background.shape[0]:\n>         return background\n>\n>     # 分离Alpha通道\n>     alpha = overlay[:, :, 3] / 255.0\n>     alpha = np.stack([alpha, alpha, alpha], axis=-1)\n>\n>     # 混合\n>     roi = background[y:y+h, x:x+w]\n>     blended = (1 - alpha) * roi + alpha * overlay[:, :, :3]\n>     background[y:y+h, x:x+w] = blended.astype(np.uint8)\n>\n>     return background\n> ```\"\n\n---"
    },
    {
      "title": "核心代码模式",
      "content": "```python\n# Pose关键点检测标准模板\npose = mp.solutions.pose.Pose()\nresults = pose.process(cv2.cvtColor(frame, cv2.COLOR_BGR2RGB))\nif results.pose_landmarks:\n    landmark = results.pose_landmarks.landmark[index]\n    x, y = int(landmark.x * w), int(landmark.y * h)\n```\n\n---"
    },
    {
      "title": "禁忌提醒",
      "content": "- 坐标超出图像边界——叠加前必须检查\n- GIF帧索引越界——用取余`%`循环\n- 忘记转换颜色空间——Pose需要RGB输入\n- Alpha通道处理错误——导致宠物有白边\n\n---"
    },
    {
      "title": "核心知识点",
      "content": "- Pose模型：33个身体关键点检测\n- 关键点索引：11左肩、12右肩、0鼻子\n- GIF处理：PIL读取、逐帧提取\n- Alpha混合：透明图片叠加公式\n\n**底层逻辑**\n- **人体姿态估计**：AI模型识别身体关键点\n- **动画循环**：帧索引取余实现无限循环\n- **透明度混合**：`(1-alpha)*背景 + alpha*前景`\n\n`#执行层` `#测评项`\n[UID: PYAI-24-12-001]\n[关联: PYAI-24-10-001 虚拟墨镜（前置课程）]\n\n---\n\n[上一课](PYAI-2-4-10_虚拟墨镜.md) | [模块概览](_模块概览.md) | [返回索引](../_索引.md)"
    }
  ],
  "full_content": "# [PYAI-2-4-12] 动物伙伴\n\n> **模块**：L2-M4 计算机视觉\n> **认知负荷**：高\n> **核心技能**：Pose模型、GIF处理、位置跟随\n> **UID**：PYAI-24-12-001\n\n---\n\n## 课程基本信息\n\n| 项目 | 内容 |\n|------|------|\n| **课程编号** | PYAI-2-4-12 |\n| **课程名称** | 动物伙伴 - 肩膀上的宠物 |\n| **认知负荷** | 高 |\n| **核心技能** | Pose模型、GIF处理、位置跟随 |\n| **项目内容** | 肩膀上的宠物 |\n\n---\n\n## 详细教学流程\n\n### 步骤1：知识讲解（20分钟）\n\n`#中负荷-操练` `#IFC-即时`\n\n**教师话术**\n> \"今天我们来做一个超酷的AR效果——**肩膀上的虚拟宠物**！\n>\n> 需要解决三个问题：\n> 1. **找到肩膀位置**：用MediaPipe Pose模型检测身体关键点\n> 2. **加载动画宠物**：处理GIF动图\n> 3. **让宠物跟随移动**：实时更新位置\n>\n> ```python\n> import mediapipe as mp\n>\n> # 初始化Pose模型\n> mp_pose = mp.solutions.pose\n> pose = mp_pose.Pose()\n>\n> # 处理图像获取关键点\n> results = pose.process(frame_rgb)\n>\n> # 获取左肩位置（索引11）和右肩位置（索引12）\n> if results.pose_landmarks:\n>     left_shoulder = results.pose_landmarks.landmark[11]\n>     right_shoulder = results.pose_landmarks.landmark[12]\n>     # 坐标是0-1的比例，需要乘以图像尺寸\n>     x = int(left_shoulder.x * width)\n>     y = int(left_shoulder.y * height)\n> ```\"\n\n**变体示例**\n\n| 学生情况 | 调整方案 | 说明 |\n|----------|----------|------|\n| 想放在头顶 | 改用头部关键点 | 索引0是鼻子，可以往上偏移 |\n| 宠物太大/太小 | 根据肩宽缩放 | 用两肩距离计算合适的宠物大小 |\n| 想用静态图片 | 简化为PNG | 不需要GIF处理，直接叠加 |\n\n---\n\n### 步骤2：代码实践（35分钟）\n\n`#高负荷-产出` `#IFC-即时`\n\n**教师话术**\n> \"现在我们来处理GIF动图。Python可以用PIL库读取GIF的每一帧：\n>\n> ```python\n> from PIL import Image\n> import numpy as np\n>\n> # 加载GIF\n> gif = Image.open('pet.gif')\n> frames = []\n>\n> # 提取所有帧\n> try:\n>     while True:\n>         # 转换为RGBA（带透明通道）\n>         frame = gif.convert('RGBA')\n>         frames.append(np.array(frame))\n>         gif.seek(gif.tell() + 1)  # 下一帧\n> except EOFError:\n>     pass  # 读完了\n>\n> # 循环播放\n> frame_index = 0\n> pet_frame = frames[frame_index % len(frames)]\n> frame_index += 1\n> ```\"\n\n---\n\n### 步骤3：叠加宠物（15分钟）\n\n`#高负荷-产出` `#IFC-即时`\n\n**教师话术**\n> \"最后把宠物叠加到肩膀位置。注意处理透明通道：\n>\n> ```python\n> def overlay_image(background, overlay, x, y):\n>     '''将带透明通道的图片叠加到背景上'''\n>     h, w = overlay.shape[:2]\n>\n>     # 确保不超出边界\n>     if x < 0 or y < 0 or x + w > background.shape[1] or y + h > background.shape[0]:\n>         return background\n>\n>     # 分离Alpha通道\n>     alpha = overlay[:, :, 3] / 255.0\n>     alpha = np.stack([alpha, alpha, alpha], axis=-1)\n>\n>     # 混合\n>     roi = background[y:y+h, x:x+w]\n>     blended = (1 - alpha) * roi + alpha * overlay[:, :, :3]\n>     background[y:y+h, x:x+w] = blended.astype(np.uint8)\n>\n>     return background\n> ```\"\n\n---\n\n## 核心代码模式\n\n```python\n# Pose关键点检测标准模板\npose = mp.solutions.pose.Pose()\nresults = pose.process(cv2.cvtColor(frame, cv2.COLOR_BGR2RGB))\nif results.pose_landmarks:\n    landmark = results.pose_landmarks.landmark[index]\n    x, y = int(landmark.x * w), int(landmark.y * h)\n```\n\n---\n\n## 禁忌提醒\n\n- 坐标超出图像边界——叠加前必须检查\n- GIF帧索引越界——用取余`%`循环\n- 忘记转换颜色空间——Pose需要RGB输入\n- Alpha通道处理错误——导致宠物有白边\n\n---\n\n## 核心知识点\n\n- Pose模型：33个身体关键点检测\n- 关键点索引：11左肩、12右肩、0鼻子\n- GIF处理：PIL读取、逐帧提取\n- Alpha混合：透明图片叠加公式\n\n**底层逻辑**\n- **人体姿态估计**：AI模型识别身体关键点\n- **动画循环**：帧索引取余实现无限循环\n- **透明度混合**：`(1-alpha)*背景 + alpha*前景`\n\n`#执行层` `#测评项`\n[UID: PYAI-24-12-001]\n[关联: PYAI-24-10-001 虚拟墨镜（前置课程）]\n\n---\n\n[上一课](PYAI-2-4-10_虚拟墨镜.md) | [模块概览](_模块概览.md) | [返回索引](../_索引.md)\n"
}